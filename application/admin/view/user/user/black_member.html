{extend name="layout/default" /}
{block name="content"}

<!--会员发送短信弹框begin-->
<div class="body-form selectMemberToSendSms auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="layui-row">
            <form action="">
                <table class="layui-table table-border dashed-td" lay-skin="line" lay-size="sm" style="margin-bottom: 15px">
                    <colgroup>
                        <col class="yty_tdright" width="110px">
                        <col class="yty_tdright">
                    </colgroup>
                    <tbody  class="step-third">
                    <tr>
                        <td class="yty_tdleft"> 号码列表 :</td>
                        <td class="yty_tdright">
                            <div class="layui-inline yty-form">
                                <ul class="phone-list">
                                    <li><span>1374654564</span><i class="fa fa-times paddingleft10 iconEvent" aria-hidden="true"></i></li>
                                    <li><sapn>1374654560</sapn><i class="fa fa-times paddingleft10 iconEvent" aria-hidden="true"></i></li>
                                    <li><sapn>1374654561</sapn><i class="fa fa-times paddingleft10 iconEvent" aria-hidden="true"></i></li>
                                    <li><sapn>1374654564</sapn><i class="fa fa-times paddingleft10 iconEvent" aria-hidden="true"></i></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td  class="yty_tdright border-bottom" colspan="2">
                            <div class="layui-row">
                                <div class="layui-col-md8">
                                    <table class="layui-table table-border dashed-td" lay-skin="line" lay-size="sm">
                                        <colgroup>
                                            <col class="yty_tdleft" width="110px">
                                            <col class="yty_tdright">
                                        </colgroup>
                                        <tbody>
                                        <tr>
                                            <td class="yty_tdleft"><span class="red_color">*</span> 卖家签名 :</td>
                                            <td colspan="2" class="yty_tdright">
                                                阿里狗
                                                <!--【<input type="text" name="sms_name" id="sms_name" value="阿里狗" placeholder="" autocomplete="off" class="layui-input">】-->
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="yty_tdleft"><span class="red_color">*</span> 短信标签 :</td>
                                            <td class="yty_tdright sms_label">
                                                <ul class="ulstyle0">
                                                    <li><a href="javascript:void(0);" id="buyer">收货人</a></li>
                                                    <li><a href="javascript:void(0);" id="order_id">订单编号</a></li>
                                                    <li><a href="javascript:void(0);" id="seller_nick_name">买家昵称</a></li>
                                                    <li><a href="javascript:void(0);" id="product_name">商品简称</a></li>
                                                    <li><a href="javascript:void(0);">商品名称</a></li>
                                                </ul>

                                                <ul class="ulstyle1">
                                                    <li><a href="javascript:void(0);" id="short_href">#短链#</a></li>
                                                    <li><a href="javascript:void(0);" id="sms_module">#短信模板#</a></li>
                                                </ul>
                                                <!--<br>-->
                                                <!--<p class="marginbuttom5"></p>-->
                                                <textarea placeholder="请输入内容" class="layui-textarea yty-textarea sms-content" id="sms-content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</textarea>
                                                <p class="font12">已输入：<span class="red_color sms-content-length">62</span> 字(包含签名) 当前计费：<span class="red_color">1</span>条 <span class="astyle tips-icon font14" title-icon="1、单条70个字,超出70个字将按照67个字每条计算<br>
2、一个汉字,数字,字母,空格都算一个字<br>
3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！">计费规则(重要)</span></p>
                                                <!--<p class="font12">1、单条70个字,超出70个字将按照67个字每条计算<br></p>
                                                <p class="font12">2、一个汉字,数字,字母,空格都算一个字<br></p>
                                                <p class="font12">3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！</p>-->
                                                <p class="font12">提示：<span class="red_color">标签和链接前后需有空格分隔，请勿删除前后空格！</span></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="yty_tdleft">短信测试 :</td>
                                            <td class="yty_tdright">
                                                <input type="text" style="font-size: 12px;width: 300px;" name="test_phone" placeholder="请输入短信测试手机号，多个手机号用逗号(,)隔开" id="test_phone" value="" placeholder="" autocomplete="off" class="layui-input">
                                                <button type="button" name="" id="" autocomplete="off" class="layui-btn layui-btn-sm  layui-btn-primary">短信测试</button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="layui-col-md4">
                                    <div class="sms-phone">
                                        <div class="phone-container">
                                            <div class="smg-content">
                                                【阿里狗】<span class="synchronize_sms_content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>

                    <tr>
                        <td class="yty_tdleft border-bottom"></td>
                        <td class="yty_tdright border-bottom">
                            <!--<div class="footer-form">-->
                            <button type="button" lay-submit="" lay-filter="" class="layui-btn yty-btn pre-step-thrid layui-btn-normal layui-btn-sm">立即发送</button>
                            <!--<button type="submit" lay-submit="" lay-filter="" class="layui-btn layui-btn-normal layui-btn-sm  layui-btn-sm">提交</button>-->
                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal cancle yty-btn">取消发送</button>
                            <!--</div>-->
                        </td>
                    </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
</div>
<!--会员发送短信弹框end-->

<!---------------------------短信模版弹出begin----------------------->
<div class="body-form sms-module-layer auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="" lay-filter="component-tabs-brief">
            <ul class="tabpage" id="tabs">
                <li class="" id="li1"><a href="#" class="tab1">推荐场景</a></li>
                <li class="" id="li2"><a href="#" class="tab2">模板库</a></li>
                <li class="" id="li3"><a href="#" class="tab3">历史发送</a></li>
                <li class="" id="li4"><a href="#" class="tab4">近期节日</a></li>
            </ul>
            <div class="contenttab" id="content">
                <div class="layui-row">
                    <div class="layui-tab-item" id="tab1">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-recommend-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="1" placeholder="" autocomplete="off" class="layui-input">
                                    <li>场景类型：
                                        <div class="layui-inline">
                                            <div class="layui-input-inline">
                                                <select name="recommended_scene" lay-verify="required" lay-search="">
                                                    <option value="4" selected>所有场景</option>
                                                    <option value="1">周年庆</option>
                                                    <option value="2">聚划算</option>
                                                    <option value="3">上新</option>
                                                </select>
                                            </div>
                                        </div>
                                    </li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab2">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="2" placeholder="" autocomplete="off" class="layui-input">
                                    <li>模板来源：
                                        <div class="layui-input-inline">
                                            <select name="modeltype" id="modeltype"  lay-verify="required" lay-search="">
                                                <option value="2" selected>所有类型</option>
                                                <option value="1">自定义模板</option>
                                                <option value="0">系统模板</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li>模板类型：
                                        <div class="layui-input-inline">
                                            <select name="selecttemp" id="selecttemp" lay-verify="required" lay-search="">
                                                <option value="0" selected="selected">所有模板</option>
                                                <option value="16">会员短信 </option>
                                                <option value="17">指定号码发送</option>
                                                <option value="18">订单短信群发 </option>
                                                <option value="1">催付提醒</option>
                                                <option value="2">发货提醒</option>
                                                <option value="3">催付关怀</option>
                                                <option value="4">派送提醒</option>
                                                <option value="5">签收提醒</option>
                                                <option value="6">回款关怀 </option>
                                                <option value="7">退款关怀 </option>
                                                <option value="8">评价关怀 </option>
                                                <option value="9">中差评安抚 </option>
                                                <option value="12">催评价 </option>
                                                <option value="13">下单提醒 </option>
                                                <option value="14">宝贝关怀 </option>
                                                <option value="15">智能凑单 </option>
                                            </select>
                                        </div>
                                    </li>
                                    <li>关键词：<input type="text" name="keyword" id="keyword" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab3">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-history-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="3" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab4">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-latest-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="4" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                </div>
                <div class="layui-row">
                    <table class="layui-hide" id="table-sms" lay-filter="table_sms" table-reload-id="tableReload"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<!---------------------------短信模版弹出end-------------------------->

<!----------------------------短链模版弹出begin----------------------->
<div class="body-form short-href-layer auto-height-table" style="display: none">
    <div class="layui-form yty-tab">
        <div class="layui-tab" lay-filter="short-href-tab">
            <ul class="layui-tab-title tabpage">
                <li class="layui-this" lay-id="common_link"><a href="#">店铺常用链接</a></li>
                <li><a href="#">宝贝链接</a></li>
                <li><a href="#">宝贝分类</a></li>
                <li><a href="#">优惠券</a></li>
                <li><a href="#">搭配套餐</a></li>
                <li><a href="#">金店长活动</a></li>
            </ul>
            <div class="layui-tab-content" style="height: 100px;">
                <!--<div class="layui-row">-->
                <div class="layui-tab-item layui-show common_link"></div>
                <div class="layui-tab-item good_link">
                    <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-good-link" lay-filter="form-sms-good-link">
                        <div class="searchbody">
                            <ul class="nav pull-left">
                                <input type="hidden" name="short_sms_type" value="1" placeholder="" autocomplete="off" class="layui-input">
                                <li>宝贝状态：
                                    <div class="layui-input-inline">
                                        <select name="goods_status" id="goods_status" lay-verify="required" lay-search="">
                                            <option value="1" selected>所有状态</option>
                                            <option value="2">出售中</option>
                                            <option value="3">仓库中</option>
                                        </select>
                                    </div>
                                </li>
                                <li>宝贝ID：<input type="text" name="goods_id" id="goods_id" placeholder="" autocomplete="off" class="layui-input"></li>
                                <li>宝贝标题：<input type="text" name="goods_title" id="goods_title" placeholder="" autocomplete="off" class="layui-input"></li>
                                <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                    <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                </li></ul>
                        </div>
                    </form>
                </div>
                <div class="layui-tab-item gategory_list"></div>
                <div class="layui-tab-item coupon_list"></div>
                <div class="layui-tab-item match_list"></div>
                <div class="layui-tab-item jdz_list">
                    <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-jdz-list" lay-filter="form-sms-jdz-list">
                        <div class="searchbody">
                            <ul class="nav pull-left">
                                <input type="hidden" name="short_sms_type" value="5" placeholder="" autocomplete="off" class="layui-input">
                                <li>活动名称：<input type="text" name="act_name" id="act_name" placeholder="" autocomplete="off" class="layui-input"></li>
                                <li>页面标题：<input type="text" name="act_title" id="act_title" placeholder="" autocomplete="off" class="layui-input"></li>
                                <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                    <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                </li></ul>
                        </div>
                    </form>
                </div>
                <!--</div>-->
                <div class="layui-row">
                    <table class="layui-hide" id="table-short-link-sms" lay-filter="table-short-link-sms" table-reload-id="tableReload"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<!----------------------------短链模版弹出end-------------------------->


<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12 webody body-overflow">
            <div class="layui-row yty-bck">
                <div class="layui-col-12">
                    <div class="searchbody">
                    </div>
                </div>
            </div>

            <div class="layui-card">
                <div class="layui-card-body">
                    <table class="layui-hide" id="memberList" lay-filter="memberList" table-reload-id="tableReload" lay-size="sm"></table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!--头工具栏-->
<!--{:build_toolbar('toolbar',['refresh', 'add', 'del', 'export'])}-->

<!------------------------表格头工具栏begin------------------------->
<script type="text/html" id="toolbar">
    <a class="layui-btn layui-btn-sm layui-btn-primary btn-primary-border" lay-event="addBlackMember"><i class="fa fa-plus"></i> 添加黑名单</a>
    <a class="layui-btn layui-btn-sm layui-btn-primary btn-primary-border" lay-event="importBlackMember"><i class="fa fa-arrow-up" aria-hidden="true"></i> 导入黑名单</a>
    <a class="layui-btn layui-btn-sm layui-btn-primary btn-primary-border-red" lay-event="delete"><i class="fa fa-trash" aria-hidden="true"></i> 删除</a>
</script>
<!-------------------------表格头工具栏end---------------------------->


<!----------------------------短信模板操作栏begin-------------------------->
<script type="text/html" id="actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
</script>
<!------------------------------短信模板操作栏end--------------------------->


<!-------------------------------短链操作栏begin-------------------------------->
<script type="text/html" id="short_sms_actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="use_sms_short_link">选择链接</a>
</script>
<!-------------------------------短链操作栏end--------------------------------->

<!--状态-->
<!--<script type="text/html" id="switchStatus">-->
<!--<input type="checkbox" name="status" value="{{d.status}}" lay-skin="switch" lay-text="激活|禁用" lay-filter="ruleStatus" {{ d.status == 1 ? 'checked' : '' }}>-->
<!--</script>-->

<!--状态-->
<!--<script type="text/html" id="switchIsmenu">-->
<!--<input type="checkbox" name="ismenu" value="{{d.ismenu}}" lay-skin="switch" lay-text="是|否" lay-filter="ruleIsmenu" {{ d.ismenu == 1 ? 'checked' : '' }}>-->
<!--</script>-->

<!--操作-->
<!--{:build_actionbar('actionbar',['edit', 'del'])}-->



{/block}

{block name="script"}
<script>
    layui.config({
        base: "__STATIC__/", //静态资源所在路径
//        skin: 'layui-layer-we'
        version:true,
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index','table','element','form','authtree','we','weTable','formSearch'], function(){
        var admin = layui.admin
            ,element = layui.element
            ,table = layui.table
            ,layer = layui.layer
            ,we = layui.we
            ,form = layui.form
            ,weTable = layui.weTable
            ,formSearch = layui.formSearch
            ,init_i = init_j = init_m = 0
            ,toastr = layui.toastr;

        layer.load(0, {shade: false});
        var tableCommon = {
            elem: '#memberList'
            ,formId:'search_form'
            ,method:'post'
            ,url:"{:url('Admin/user.user/index')}"
            ,id : 'tableReload'
            ,skin:'line'
            ,toolbar : '#toolbar'
            ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
//            ,limit : 4
            ,loading:true
            ,limit:10
            ,defaultToolbar: ['filter']//'filter', 'print', 'exports'
            ,search: true
            ,cols: [[
                {type:'checkbox', fixed: 'left',}
                ,{field:'id', title: 'ID', sort: true, excel_width:15,hide:false}
                ,{field:'yxName', title: "云信昵称", sort: true, excel_width:15, searchList:{type:'input',operate:'LIKE'}, minWidth: 120}
                ,{field:'phone', title: "手机号", excel_width:15, searchList:{type:'input',operate:'LIKE'}, minWidth: 130}
                ,{field:'remarks', title: "备注", excel_width:15, minWidth: 120}
                ,{field:'lastTradingTime', title: "拉黑时间", excel_width:15, searchList:{type:'input',event:'date',operate: 'RANGE'}, minWidth: 140}
                ,{fixed: 'right', title:"{:__('Operate')}", toolbar: '#actionbar', width:200}
            ]]
            ,page: {
                layout: ['limit', 'count', 'prev', 'page', 'next', 'skip']
                ,all:"{:__('Total')}"
                ,item:"{:__('Item')}"
                ,confirm:"{:__('Confirm')}"
                ,page:"{:__('Page')}"
                ,ipage:"{:__('IPage')}"
                ,to:"{:__('To')}"
                ,first: "{:__('First')}"
                ,last: "{:__('Last')}"
                ,prev: "{:__('Previous')}"
                ,next: "{:__('Next')}"
            }
            ,done: function(res, curr, count){
//                if(res.status == 'success') {
                layer.closeAll();
//                }
            }
            ,error:function () {
                layer.closeAll();
            }
        }

        table.render(tableCommon); //数据表格初始化
        formSearch.api.init(tableCommon); //搜索初始化

        /**
         * 表格初始化
         */
        /*weTable.api.init({
            table : "memberList",
            is_display:false,
            tableid : "tableReload",
            form:$("form#search_form"),
            tableCommon: tableCommon,
            extend : {
                "add_url": "{:url('admin/user.user/edit',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}",
                "edit_url": "{:url('admin/user.user/edit',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}&ids=",
                "view_url": "{:url('admin/user.user/view',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}&ids=",
                "del_url": "{:url('admin/user.user/del',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}",
                "export_url" : "{:url('admin/user.user/index',['id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}"
            }
        });*/

        /**
         * 绑定监听事件
         * */
        //weTable.api.bindevent();
        formSearch.api.searchForm($("form#search_form"));

        //表头工具栏事件
        table.on('toolbar(memberList)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            var data = checkStatus.data;
            var idsArr = [];
            console.log(data);
            $.each(data,function (index, value) {
                idsArr.push(value.id);
            });
            switch(obj.event) {
                case 'addBlackMember':
                    layer_index1 = we.api.open("{:url('admin/user.user/addBlackMember')}",'新增会员',{zIndex:19891016
                    },['80%' , '80%']);
                    break;
                case 'importBlackMember':
                    we.api.open("{:url('admin/user.user/import','',false)}",'导入会员信息');
                    break;
                case 'delete':
                    if(data != "") {
                        layer.confirm('请确定是否删除？',{
                            skin: 'layui-layer-we',
                            title:'温馨提示',
                        }, function(index){
                            we.api.ajax({"url":"","data":{'ids':idsArr.join(',')},'tableid':'tableReload','action':'del'});
                            layer.close(index);
                        });
                    } else {
                        toastr.warning('没有选择数据');
                    }
                    break;
            }
        })

        /**
         * 表格工具栏事件
         * */
        table.on('tool(memberList)', function(obj){
            var data = obj.data;
            switch(obj.event){
                case 'sendSms':
                    //设置发送手机号码
                    $(".phone-list").html('<li><span>1374654564</span><i class="fa fa-times paddingleft10 iconEvent" aria-hidden="true"></i></li>');
                    layer_index2 = we.api.open_current_page_layer($(".selectMemberToSendSms"),'选则订单发送',{zIndex:19891016
                    },['80%' , '80%']);
                    break;
                case 'edit':
                    we.api.open("{:url('admin/user.user/edit',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}&ids="+data.id,'编辑');
                    break;
                case 'del':
                    layer.confirm('请确定是否删除？',{
                        title:'温馨提示',
                    }, function(index){
                        var url = weTable.defaults.extend.del_url
                        we.api.ajax({"url":"{:url('admin/user.user/del',['nav_id'=>input('nav_id'),'nav_pid'=>input('nav_pid')],false)}","data":{'ids':data.id},'tableid':"tableReload",'action':'del'});
                        layer.close(index);
                    });
                    break;
            }
        });

        /**
         * 点击删除号码
         */
        $("body").on("click",".iconEvent",function (){
            $(this).parent("li").remove();
        });

        /**
         * 点击取消
         * 关掉layer弹层
         */
        $("body").on("click",".cancle",function (){
            layer.close(layer_index);
        });

        /**
         * 短信标签设置
         */
        $("body").on("click",".sms_label ul li",function (){
            console.log($(this).text());
            var label_id = $(this).children().attr('id');
            var content = "{" +$(this).text()+ "}";
            if(typeof label_id !== 'undefined'){
                console.log(label_id);
                var title = '';
                if(label_id == 'order_id'){
                    title = '{订单编号} 实际替换后长度约为16个字，实际扣费以发出字数为准，您是否确定添加？';
                } else if(label_id == 'product_name'){
                    title = "{商品简称} 需要对宝贝设置对应的商品简称，未设置简称的宝贝加入该标签将不展示标签内容，您可以选择继续添加或者<a class='astyle' href='javascript:void(0);'>设置商品简称</a>？";
                } else if(label_id == 'sms_module' || label_id == 'short_href') {
                    return false;
                }
                if(title != '') {
                    layer.confirm(title,{
                        title:'温馨提示',area: ['400px','250px'],zIndex:19891016
                    }, function(index){
                        we.insertText(document.getElementById("sms-content"),content)
                        layer.close(index);
                    });
                } else {
                    we.insertText(document.getElementById("sms-content"),content)
                }
            } else {
                we.insertText(document.getElementById("sms-content"),content)
            }
        });


        /**
         *修改短信内容后点击确定
         * sms-confirm
         * */
        $("body").on("click",".sms-confirm",function (){
            $('.sms-content-last').val($('.sms-content').val());
        });


        /**
         * 短信标签 输入框输入
         */
        $('#sms-content').bind('input porpertychange',function(){
            console.log($(this).val().length);
            $('.synchronize_sms_content').text($(this).val());
            $('.sms-content-length').text($(this).val().length);
        });

        /**
         * 选择模板短信
         * */
        $("body").on("click","#sms_module,#tabs .tab1",function (){
            // console.log(this);
            var title = "tab1";
            $("#tabs").find("li[id^=li]").not("li[id=" + title + "]").removeClass("currenttab");
            $('#li1').addClass('currenttab');
            $("#content").find("div[id^=tab]").not("div[id=" + title + "]").hide();
            $("#content").find("div[id=" + title + "]").fadeIn();
            sms_table_init("form#form-recommend-sms-module",1);
        })

        /**
         * 短信模板切换初始化
         * */
        $("#tabs").find("li[id^=li]").find("a").bind("click", function () {
            var title = $(this).attr("class");
            // console.log($("#content").find("div[id=" + title + "]").find("form").attr('id'));
            sms_table_init("form#"+$("#content").find("div[id=" + title + "]").find("form").attr('id'),0);
        })


        /**
         * 选择短信模板初始化，sms_type：1推荐场景，sms_type：2模板库，sms_type：3历史发送，sms_type：4近期节日
         * */
        function sms_table_init(form,flag){
            var tableCommon = {
                elem: '#table-sms'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                // ,toolbar : '#toolbar'
                ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: [[
                    {type:'checkbox', fixed: 'left', hide:true}
                    ,{field:'sms_id', title: 'id', hide:true}
                    ,{field:'sms_content', title: '短信内容'}
                    ,{fixed: 'right', title:'操作', toolbar: '#actionbar', width:250}
                ]]
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            if((form == "form#form-recommend-sms-module" && init_i == 0) || flag == 1) {
                index_sms = we.api.open_current_page_layer($(".sms-module-layer"),'选择短信模版',{zIndex:19891018
                },['80%' , '80%']);//搜索短信模版弹框
                if(init_i == 0){
                    $.each($("#content .layui-row .layui-tab-item"),function (index, value) {
                        formSearch.api.searchForm($("form#" + $(this).find("form").attr("id"))); //短信模板查询事件初始化
                    })
                }
            }
            init_i ++;
        }
        //选择短信模板头工具栏事件
        table.on('tool(table_sms)', function(obj){
            console.log(obj);
            var data = obj.data;
            console.log(data.sms_id);
            if(obj.event === 'use_sms_module'){
                layer.close(index_sms)
                $(".sms-content").val(data.sms_content)
                $(".synchronize_sms_content").text(data.sms_content)
                $('.sms-content-length').text(data.sms_content.length);
            } else if(obj.event === 'del_sms_module') {
                var sms_id = data.sms_id;
                var url = "";
                we.api.ajax({"url":url,"data":{'sms_id':sms_id}});   //对接后台删除
                //执行删除
            }
        })



        /**
         * 短链接弹框short-href-layer
         * */
        $("body").on("click","#short_href",function (){
            sms_short_table_init('', {'short_sms_type':0});
            element.tabChange('short-href-tab', 'common_link');
            short_sms_layer_index = we.api.open_current_page_layer($(".short-href-layer"),'添加短链',{zIndex:19891016
            },['80%' , '80%']);
        })

        /**
         * 短链切换监听
         * */
        element.on('tab(short-href-tab)', function(data){
            var where = {'short_sms_type':data.index};
            switch (data.index) {
                case 0:
                    sms_short_table_init('', where);
                    break;
                case 1:
                    sms_short_table_init('', where);
                    break;
                case 2:
                    sms_short_table_init('', where);
                    break;
                case 3:
                    sms_short_table_init('', where);
                    break;
                case 4:
                    sms_short_table_init('', where);
                    break;
                case 5:
                    sms_short_table_init('', where);
                    break;
            }

        });

        /**
         * 短链接表格初始化
         * */
        function sms_short_table_init(form,where,flag){
            var cols1 = [[
                {type:'checkbox', fixed: 'left', hide:true}
                ,{field:'sms_id', title: 'id', hide:true}
                ,{field:'sms_content', title: '短链内容'}
                ,{fixed: 'right', title:'操作', toolbar: '#short_sms_actionbar', width:250}
            ]];

            var cols2 = [[
                {type:'checkbox', fixed: 'left', hide:true}
                ,{field:'sms_id', title: 'id', hide:true}
                ,{field:'activity_name',title:'活动名称'}
                ,{field:'sms_content', title: '活动标题'}
                ,{field:'sms_create_time', title: '创建时间'}
                ,{fixed: 'right', title:'操作', toolbar: '#short_sms_actionbar', width:250}
            ]];
            var cols = cols1;
            if(typeof where !== 'undefined'){
                var cols = where.short_sms_type == 5 ? cols2 : cols1;
            }
            console.log(where)
            var tableCommon = {
                elem: '#table-short-link-sms'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                // ,toolbar : '#toolbar'
                // ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: cols
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where:where
                // ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            if(init_j == 0){
                formSearch.api.searchForm($("form#form-sms-good-link"));
                formSearch.api.searchForm($("form#form-sms-jdz-list"));
            }
            init_j ++;
            /**
             * 绑定监听事件
             * */
        }

        //短链工具栏事件
        table.on('tool(table-short-link-sms)', function(obj){
            console.log(obj);
            var data = obj.data;
            console.log(data.sms_id);
            if(obj.event === 'use_sms_short_link'){
                layer.close(short_sms_layer_index)
                we.insertText(document.getElementById("sms-content"),'c.tb.cn/c.02iCLm')//测试数据
            } else if(obj.event === 'del_sms_module') {

            }
        })
    });
</script>
</body>
</html>
{/block}