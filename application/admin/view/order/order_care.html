{extend name="layout/default" /}
{block name="content"}
<!--短信模版弹出begin-->
<div class="body-form sms-module-layer auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="" lay-filter="component-tabs-brief">
            <ul class="tabpage" id="tabs">
                <li class="" id="li1"><a href="#" class="tab1">推荐场景</a></li>
                <li class="" id="li2"><a href="#" class="tab2">模板库</a></li>
                <li class="" id="li3"><a href="#" class="tab3">历史发送</a></li>
                <li class="" id="li4"><a href="#" class="tab4">近期节日</a></li>
            </ul>
            <div class="contenttab" id="content">
                <div class="layui-row">
                    <div class="layui-tab-item" id="tab1">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-recommend-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="1" placeholder="" autocomplete="off" class="layui-input">
                                    <li>场景类型：
                                        <select name="recommended_scene" id="recommended_scene">
                                            <option value="4" selected>所有场景</option>
                                            <option value="1">周年庆</option>
                                            <option value="2">聚划算</option>
                                            <option value="3">上新</option>
                                        </select>
                                    </li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab2">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="2" placeholder="" autocomplete="off" class="layui-input">
                                    <li>模板来源：
                                        <select name="modeltype" id="modeltype">
                                            <option value="2" selected>所有类型</option>
                                            <option value="1">自定义模板</option>
                                            <option value="0">系统模板</option>
                                        </select>
                                    </li>
                                    <li>模板类型：
                                        <select name="selecttemp" id="selecttemp">
                                            <option value="0" selected="selected">所有模板</option>
                                            <option value="16">会员短信 </option>
                                            <option value="17">指定号码发送</option>
                                            <option value="18">订单短信群发 </option>
                                            <option value="1">催付提醒</option>
                                            <option value="2">发货提醒</option>
                                            <option value="3">催付关怀</option>
                                            <option value="4">派送提醒</option>
                                            <option value="5">签收提醒</option>
                                            <option value="6">回款关怀 </option>
                                            <option value="7">退款关怀 </option>
                                            <option value="8">评价关怀 </option>
                                            <option value="9">中差评安抚 </option>
                                            <option value="12">催评价 </option>
                                            <option value="13">下单提醒 </option>
                                            <option value="14">宝贝关怀 </option>
                                            <option value="15">智能凑单 </option>
                                        </select>
                                    </li>
                                    <li>关键词：<input type="text" name="keyword" id="keyword" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab3">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-history-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="3" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab4">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-latest-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="4" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                </div>

                <div class="layui-row">
                <table class="layui-hide" id="table-sms" lay-filter="table_sms" table-reload-id="tableReload"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--短信模版弹出end-->

<!--短链模版弹出begin-->
<div class="body-form short-href-layer auto-height-table" style="display: none">
    <div class="layui-form yty-tab">
        <div class="layui-tab" lay-filter="short-href-tab">
            <ul class="layui-tab-title tabpage">
                <li class="layui-this"><a href="#">店铺常用链接</a></li>
                <li><a href="#">宝贝链接</a></li>
                <li><a href="#">宝贝分类</a></li>
                <li><a href="#">优惠券</a></li>
                <li><a href="#">搭配套餐</a></li>
                <li><a href="#">金店长活动</a></li>
            </ul>
            <div class="layui-tab-content" style="height: 100px;">
                <div class="layui-tab-item layui-show common_link">内容不一样是要有，因为你可以监听tab事件（阅读下文档就是了）</div>
                <div class="layui-tab-item good_link">内容2</div>
                <div class="layui-tab-item gategory_list">内容3</div>
                <div class="layui-tab-item coupon_list">内容4</div>
                <div class="layui-tab-item match_list">内容5</div>
                <div class="layui-tab-item jdz_list">内容6</div>
            </div>
        </div>
    </div>
</div>
<!--短链模版弹出end-->

<!--修改短信内容弹出begin-->
<div class="body-form sms-layer" style="display: none">
    <div class="layui-form">
        <div class="layui-card main-table">
            <div class="layui-card-body main-body">
                <blockquote class="layui-elem-quote layui-text layui-quote-style">
                    <p>1. 短信中插入标签或链接时，<span class="red_color">标签或链接前后需有空格分隔</span>，请勿删除前后空格，否则可能导致无法正常替换和跳转；</p>
                    <p>2. 短信内容中若含有促销词如:微信、QQ、店庆等,请务必在短信内容末尾添加“退订回N”</p>
                </blockquote>
                <div class="layui-row">
                    <div class="layui-col-md8">
                        <table class="layui-table table-border dashed-td" lay-skin="line" lay-size="sm">
                            <colgroup>
                                <col class="yty_tdleft" width="30%">
                                <col class="yty_tdright">
                            </colgroup>
                            <tbody>
                            <tr>
                                <td class="yty_tdleft"><span class="red_color">*</span> 短信签名</td>
                                <td colspan="2" class="yty_tdright">
                                    【<input type="text" name="sms_name" id="sms_name" value="阿里狗" placeholder="" autocomplete="off" class="layui-input">】
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"><span class="red_color">*</span> 短信标签</td>
                                <td class="yty_tdright sms_label">
                                    <ul class="ulstyle0">
                                        <li><a href="javascript:void(0);" id="buyer">收货人</a></li>
                                        <li><a href="javascript:void(0);" id="order_id">订单编号</a></li>
                                        <li><a href="javascript:void(0);" id="seller_nick_name">买家昵称</a></li>
                                        <li><a href="javascript:void(0);" id="product_name">商品简称</a></li>
                                        <li><a href="javascript:void(0);">商品名称</a></li>
                                    </ul>

                                    <ul class="ulstyle1">
                                        <li><a href="javascript:void(0);" id="short_href">#短链#</a></li>
                                        <li><a href="javascript:void(0);" id="sms_module">#短信模板#</a></li>
                                    </ul>
                                    <!--<br>-->
                                    <!--<p class="marginbuttom5"></p>-->
                                    <textarea placeholder="请输入内容" class="layui-textarea yty-textarea sms-content" id="sms-content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</textarea>
                                    <p class="font12">已输入：<span class="red_color">68</span> 字(包含签名) 当前计费：<span class="red_color">1</span>条 <span class="astyle tips-icon font14" title-icon="1、单条70个字,超出70个字将按照67个字每条计算<br>
2、一个汉字,数字,字母,空格都算一个字<br>
3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！">计费规则(重要)</span></p>
                                    <!--<p class="font12">1、单条70个字,超出70个字将按照67个字每条计算<br></p>
                                    <p class="font12">2、一个汉字,数字,字母,空格都算一个字<br></p>
                                    <p class="font12">3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！</p>-->
                                    <p class="font12">提示：<span class="red_color">标签和链接前后需有空格分隔，请勿删除前后空格！</span></p>
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft">短信测试</td>
                                <td class="yty_tdright">
                                    <input type="text" style="font-size: 12px;width: 300px;" name="test_phone" placeholder="请输入短信测试手机号，多个手机号用逗号(,)隔开" id="test_phone" value="" placeholder="" autocomplete="off" class="layui-input">
                                    <button type="button" name="" id="" autocomplete="off" class="layui-btn layui-btn-sm  layui-btn-primary">短信测试</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="layui-col-md4">
                        <div class="sms-phone">
                            <div class="phone-container">
                                <div class="smg-content">
                            【覃雪宁88】<span class="synchronize_sms_content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item layer-form-footer">
                    <div class="footer-inner">
                        <button type="submit" lay-submit="" lay-filter="formRule"
                                class="layui-btn layui-btn-normal submit layui-btn-sm btn-embossed">{:__('OK')}
                        </button>
                        <button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed reset">
                            {:__('Reset')}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--修改短信内容弹出end-->

<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12 webody">
            <div class="layui-card main-table">
                <div class="layui-card-header yty-card-header"><span class="sm-st-icon-left shop-info"><i class="fa  fa-ellipsis-v"></i></span>下单关怀</div>
                <div class="layui-card-body main-body">
                    <!--表格查询条件begin-->
                    <!--<div class="searchbody">-->
                        <form class="layui-form" method="post" action="" tableid="tableReload" id="formRule" lay-filter="rule">
                            <table class="layui-table table-border  dashed-td" lay-skin="line" lay-size="sm" style="margin-bottom: 15px">
                                <colgroup>
                                    <col class="yty_tdright" width="100px">
                                    <col class="yty_tdright">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <td class="yty_tdleft"> 是否开启 :</td>
                                    <td class="yty_tdright">
                                        <!--<div class="layui-form-item">-->
                                            <!--<div class="layui-input-block">-->
                                                <input type="radio" name="switch" value="1" title="开">
                                                <input type="radio" name="switch" value="0" title="关" checked="">
                                            <!--</div>-->
                                        <!--</div>-->
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 任务名称 :</td>
                                    <td class="yty_tdright">
                                        <input type="text" name="taskname" id="taskname" placeholder="" autocomplete="off" class="layui-input">
                                        <span>(仅软件内部使用)</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 发送日期 :</td>
                                    <td class="yty_tdright">
                                        <!--<div class="layui-form-item">-->
                                        <!--<div class="layui-input-block">-->
                                        <input type="radio" name="date_switch" lay-filter="date_switch" value="1" title="不限日期" checked="">
                                        <input type="radio" name="date_switch" lay-filter="date_switch" value="0" title="指定日期">
                                        <!--</div>-->
                                        <!--</div>-->
                                    </td>
                                </tr>

                                <tr class="task_time" style="display: none">
                                    <td class="yty_tdleft">任务时间 :</td>
                                    <td class="yty_tdright">
                                        <input type="text" name="task_time_start" id="task_time_start" placeholder="" autocomplete="off" class="layui-input"> — <input type="text" name="task_time_end" id="task_time_end" placeholder="" autocomplete="off" class="layui-input input-margin">
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 发送时间 :</td>
                                    <td class="yty_tdright">
                                        每天 <input type="text" name="day_hour_start" id="day_hour_start" placeholder="" autocomplete="off" class="layui-input"> 时 至
                                        <input type="text" name="day_hour_end" id="day_hour_end" placeholder="" autocomplete="off" class="layui-input">
                                        时，发送关怀提醒 (其他时间自动延迟到次日发送)
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <input type="radio" name="date_notice_switch" lay-filter="date_notice_switch" value="1" title="超出时间次日通知" checked="">
                                        <input type="radio" name="date_notice_switch" lay-filter="date_notice_switch" value="0" title="超出时间不发送">
                                        <br>
                                        <p class="marginbuttom5"></p>
                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        午休时间 <input type="text" name="day_hour_start" id="siesta_hour_start" placeholder="" autocomplete="off" class="layui-input"> 时 至
                                        <input type="text" name="day_hour_end" id="siesta_hour_end" placeholder="" autocomplete="off" class="layui-input">
                                        不发送
                                        <i class="fa fa-question-circle tips-icon" title-icon="为避免午休时间内打扰客户休息，可选择午休时间通知短信自动顺延发送，勾选则顺延发送。"></i>
                                        <!--为避免午休时间内打扰客户休息，可选择午休时间通知短信自动顺延发送，勾选则顺延发送。-->
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 关怀条件 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        实付金额 <input type="number" value="0.00" min="0" name="actually_paid_start" id="actually_paid_start" placeholder="" autocomplete="off" class="layui-input"> —
                                        <input type="number" min="0" value="0.00" name="actually_paid_end" id="actually_paid_end" placeholder="" autocomplete="off" class="layui-input">元
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        商品数量 <input type="number" value="0" min="0" name="number_of_products_start" id="number_of_products_start" placeholder="" autocomplete="off" class="layui-input"> —
                                        <input type="number" min="0" value="" name="number_of_products_end" id="number_of_products_end" placeholder="" autocomplete="off" class="layui-input">件
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <div class="layui-inline yty-form">
                                        <span>订单中</span>
                                            <div class="layui-input-inline">
                                            <select name="modules" lay-verify="required" lay-search=""><option value="1">包含</option><option value="0">不包含</option></select>
                                            </div>
                                        <span>指定商品</span>
                                            <button type="button" name="" id="" placeholder="" autocomplete="off" class="layui-btn layui-btn-sm  layui-btn-primary">默认不选择商品</button>
                                        </div>
                                        <br>
                                        <p class="marginbuttom5"></p>
                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">订单类型为<span style="color: #FF5722">货到付款</span>时才发送提醒
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 过滤设置 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        <div class="layui-inline yty-form">
                                            <span>不发送</span>
                                            <div class="layui-input-inline">
                                                <select name="modules" lay-verify="required" lay-search="">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3" selected>3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                </select>
                                            </div>
                                            <span>天内有过付款的客户</span>
                                        </div>
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        不发送标旗订单
                                        <div class="layui-inline yty-form">
                                        <ul class="yty-checkbox">
                                            <li class="checkbox-active"><span class="red_flag"></span></li>
                                            <li><span class="yellow_flag"></span></li>
                                            <li><span class="cyan_flag"></span></li>
                                            <li><span class="blue_flag"></span></li>
                                            <li><span class="purple_flag"></span></li>
                                        </ul>
                                        </div>
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        不发送订单来源
                                        <input type="checkbox" name="order_from[pc]" lay-skin="primary"  title="PC端">
                                        <input type="checkbox" name="order_from[mobile]" lay-skin="primary"  title="移动端">
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">当收货地区是
                                        <input type="text" name="shipping_address" id="shipping_address" placeholder="" autocomplete="off" class="layui-input"> 时,短信不提醒！
                                        <br>
                                        <p class="marginbuttom5"></p>

                                        不发送黑名单客户 <a href="javascript:void(0);" class="astyle">设置黑名单</a>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="yty_tdleft"> 赠送礼品 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="date[check]" lay-skin="primary"  title="" checked="">
                                        <div class="layui-inline yty-form">
                                            <span>赠送流量</span>
                                            <a href="javascript:void(0);" class="astyle">选择流量卡 </a>
                                            <a href="javascript:void(0);" class="astyle">流量充值 </a>
                                        </div>
                                    </td>
                                </tr>

                                <tr class="yty-form">
                                    <td class="yty_tdleft"> 短信内容 :</td>
                                    <td class="yty_tdright">
                                        <div class="layui-inline layui-form">
                                            <textarea placeholder="请输入内容" class="layui-textarea yty-textarea" readonly>注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</textarea>
                                            <a href="javascript:void(0);" class="astyle sms-event">修改短信内容</a>
                                            <a href="javascript:void(0);" class="astyle sms_record">短信测试记录</a>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <div class="layui-form-item footer-form">
                                <div class="footer footer-common">
                                    <button type="submit" lay-submit="" lay-filter="formRule" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed disabled">{:__('OK')}</button>
                                    <button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed">{:__('Reset')}</button>
                                    <a href="{:url($return_url)}"><div type="reset" style="margin-left: 10px" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed go-back">返回</div></a>
                                    <!--onclick="window.history.go(-1)"-->
                                </div>
                            </div>
                        </form>
                    <!--</div>-->
                    <!--表格查询条件end-->

                    <!--订单查询结果begin-->
                    <!--<table class="layui-hide" id="rule" lay-filter="rule" table-reload-id="tableReload"></table>-->
                    <!--订单查询结果end-->
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!--头工具栏-->
<!--{:build_toolbar('toolbar',['refresh'])}-->

<!--表格头部按钮begin-->
<!--<script type="text/html" id="toolbar">-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="search"><i class="fa fa-search"></i> 查询</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="sendSms"><i class="fa fa-envelope-o"></i> 发送短信</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="sendSearchResultSms"><i class="fa fa-envelope-o"></i> 按查询结果发送</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="addOrder"><i class="fa fa-plus"></i> 添加订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="importOrder"><i class="fa fa-file-text-o"></i> 导入苏宁订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="exportOrder"><i class="fa fa-file-o"></i> 导出苏宁订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="toBlack"><i class="fa fa-hand-o-down"></i> 拉黑</a>-->
<!--</script>-->
<!--表格头部按钮end-->

<!--头工具栏-->

<!--状态-->
<script type="text/html" id="switchStatus">
    <input type="checkbox" name="status" value="{{d.status}}" lay-skin="switch" lay-text="启用|禁用" lay-filter="ruleStatus" {{ d.status == 1 ? 'checked' : '' }}>
</script>

<!--状态-->
<script type="text/html" id="switchPush">
    <input type="checkbox" name="is_time_push" value="{{d.is_time_push}}" lay-skin="switch" lay-text="是|否" lay-filter="ruleIsmenu" {{ d.is_time_push == 1 ? 'checked' : '' }}>
</script>

<!--操作-->
<!--{:build_actionbar('actionbar',['edit','test', 'del'])}-->
<script type="text/html" id="actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="use_sms_module">使用</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del_sms_module">删除</a>
</script>


{/block}

{block name="script"}
<script>
    layui.config({
        base: "__STATIC__/", //静态资源所在路径
        skin: 'layui-layer-we',
        version:true,
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index','table','upload','laydate','element','form','authtree','we','weTable','formSearch'], function(){
        var admin = layui.admin
            ,element = layui.element
            ,layer = layui.layer
            ,we = layui.we
            ,table = layui.table
            ,$  = layui.$
            ,laydate = layui.laydate
            ,form = layui.form
            ,weTable = layui.weTable
            ,formSearch = layui.formSearch
            ,init_i = 0
            ,toastr = layui.toastr;

        /**
         *
         * 时间初始化
         * */
        laydate.render({
            elem: '#day_hour_start' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'09:00:00'
        });
        laydate.render({
            elem: '#day_hour_end' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'21:00:00'
        });

        laydate.render({
            elem: '#siesta_hour_start' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'12:00:00'
        });
        laydate.render({
            elem: '#siesta_hour_end' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'13:00:00'
        });

        laydate.render({
            elem: '#task_time_start' //指定元素
            ,type: 'date'
            // ,format:'H'
        });
        laydate.render({
            elem: '#task_time_end' //指定元素
            ,type: 'date'
            // ,format:'H'
        });

        /**
         *
         * 发送时间事件切换
         * */
        form.on('radio(date_switch)', function(data){
            // console.log(data.elem);
            // console.log(data.value)
            if(data.value == 0){
                $(".task_time").show()
            }else(
                $(".task_time").hide()
            )
        });


        /**
         * 屏蔽标旗点击切换
         */
        $("body").on("click","ul li",function (){
            if($(this).hasClass('checkbox-active')) {
                $(this).removeClass('checkbox-active');
            } else {
                $(this).addClass('checkbox-active')
            }
        });

        /**
         * 修改短息内容弹框
         */
        $("body").on("click",".sms-event",function (){
            we.api.open_current_page_layer($(".sms-layer"),'修改短息内容',{zIndex:19891015
            },['80%' , '80%']);
            var areaId = [];
            var areaIdCh = []
            //选中省份
            $("body").on("click",".submit",function (){
                $(".body-form input[type=checkbox]").each(function (index,value) {
                    if($(this).is(':checked') && $(this).val() != 'on') {
                        areaId.push($(this).val());
                        areaIdCh.push($(this).attr('title'));
                    }
                })
                $("#areaId").val(areaIdCh.join(','));
                $("#areaIdH").val(areaId.join(','));
                layer.closeAll();
            });
            //重置
            $("body").on("click",".reset",function (){
                layer.closeAll();
            });
        })

        /**
         * 选择模板短信
         * */
        $("body").on("click","#sms_module,#tabs .tab1",function (){
            // console.log(this);
            var title = "tab1";
            $("#tabs").find("li[id^=li]").not("li[id=" + title + "]").removeClass("currenttab");
            $('#li1').addClass('currenttab');
            $("#content").find("div[id^=tab]").not("div[id=" + title + "]").hide();
            $("#content").find("div[id=" + title + "]").fadeIn();
            sms_table_init("form#form-recommend-sms-module",1);
        })

        /**
         * 短信模板切换初始化
         * */
        $("#tabs").find("li[id^=li]").find("a").bind("click", function () {
            var title = $(this).attr("class");
            // console.log($("#content").find("div[id=" + title + "]").find("form").attr('id'));
            sms_table_init("form#"+$("#content").find("div[id=" + title + "]").find("form").attr('id'),0);
        })


        /**
         * 选择短信模板初始化，sms_type：1推荐场景，sms_type：2模板库，sms_type：3历史发送，sms_type：4近期节日
         * */
        function sms_table_init(form,flag){
            var tableCommon = {
                elem: '#table-sms'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                // ,toolbar : '#toolbar'
                ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: [[
                    {type:'checkbox', fixed: 'left', hide:true}
                    ,{field:'sms_id', title: 'id', hide:true}
                    ,{field:'sms_content', title: '短信内容'}
                    ,{fixed: 'right', title:'操作', toolbar: '#actionbar', width:250}
                ]]
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            if((form == "form#form-recommend-sms-module" && init_i == 0) || flag == 1) {
               index_sms = we.api.open_current_page_layer($(".sms-module-layer"),'选择短信模版',{zIndex:19891016
                },['80%' , '80%']);//搜索短信模版弹框

                // $.each($("#content .layui-row .layui-tab-item"),function (index, value) {
                //     console.log($(this).find("form").attr("id"));
                // })

                if(init_i == 0){
                    $.each($("#content .layui-row .layui-tab-item"),function (index, value) {
                        // console.log($(this).find("form").attr("id"));
                        formSearch.api.searchForm($("form#" + $(this).find("form").attr("id"))); //短信模板查询事件初始化
                    })
                    // formSearch.api.searchForm($("form#form-recommend-sms-module"));
                    // formSearch.api.searchForm($("form#form-history-sms-module"));
                    // formSearch.api.searchForm($("form#form-sms-module"));
                    // formSearch.api.searchForm($("form#form-latest-sms-module"));
                }
            }
            init_i ++;
            /**
             * 绑定监听事件
             * */
            // formSearch.api.searchForm($(form));
            // console.log(index_sms);
            //formSearch.api.searchForm($("form#form-recommend-sms-module"));////短信搜索初始化【推荐场景】
            //formSearch.api.searchForm($("form#form-sms-module"));//短信搜索初始化【模板库】
        }

        /**
         *
         * 搜索短信模板
         * */
        /*$('body').on('click','.search-info',function () {
            console.log(JSON.stringify(formSearch.api.getFormJson("#form-sms-module")));
        })*/

        //头工具栏事件
        table.on('tool(table_sms)', function(obj){
            console.log(obj);
            var data = obj.data;
            console.log(data.sms_id);
            if(obj.event === 'use_sms_module'){
                layer.close(index_sms)
                $(".sms-content").val(data.sms_content)
                $(".synchronize_sms_content").text(data.sms_content)
            } else if(obj.event === 'del_sms_module') {
                var sms_id = data.sms_id;
                var url = "";
                we.api.ajax({"url":url,"data":{'sms_id':sms_id}});   //对接后台删除
                //执行删除
            }
        })

        /**
         * 短链接弹框short-href-layer
         * */
        $("body").on("click","#short_href",function (){
            // console.log(this);
            we.api.open_current_page_layer($(".short-href-layer"),'添加短链',{zIndex:19891016
            },['80%' , '80%']);
        })

        /**
         * 短链切换监听
         * */
        element.on('tab(short-href-tab)', function(data){
            // console.log(this); //当前Tab标题所在的原始DOM元素
            console.log(data.index); //得到当前Tab的所在下标
            // console.log(data); //得到当前的Tab大容器

            switch (data.index) {
                case 0:
                    break;
                case 1:
                    break;
                case 2:
                    break;
                case 3:
                    break;
                case 4:
                    break;
                case 5:
                    break;
            }

        });

        /**
         * sms_record短信测试发送记录
         * */
        $("body").on("click",".sms_record",function (){
            var url = "{:url('admin/order/sms_record')}"
            we.api.open(url,'短信测试发送记录');
        })

        /**
         * tips-icon 弹出信息、销毁信息
         */
        $("body").on("mouseenter",".tips-icon",function (){
            var title = $(this).attr('title-icon');
            // console.log(title)
            index = layer.tips(title,this, {tips:[1,"#506def"],time:0,area: '400px',zIndex:1000000000})
        })
        $("body").on("mouseleave",".tips-icon",function (){
            layer.close(index);
        })

        /**
         * 短信标签设置
         */
        $("body").on("click",".sms_label ul li",function (){
            console.log($(this).text());
            var label_id = $(this).children().attr('id');
            var content = "{" +$(this).text()+ "}";
            if(typeof label_id !== 'undefined'){
                console.log(label_id);
                var title = '';
                if(label_id == 'order_id'){
                    title = '{订单编号} 实际替换后长度约为16个字，实际扣费以发出字数为准，您是否确定添加？';
                } else if(label_id == 'product_name'){
                    title = "{商品简称} 需要对宝贝设置对应的商品简称，未设置简称的宝贝加入该标签将不展示标签内容，您可以选择继续添加或者<a class='astyle' href='javascript:void(0);'>设置商品简称</a>？";
                } else if(label_id == 'sms_module' || label_id == 'short_href') {
                    return false;
                }
                if(title != '') {
                    layer.confirm(title,{
                        title:'温馨提示',area: ['400px','250px'],zIndex:19891016
                    }, function(index){
                        insertText(document.getElementById("sms-content"),content)
                        layer.close(index);
                    });
                } else {
                    insertText(document.getElementById("sms-content"),content)
                }
            } else {
                insertText(document.getElementById("sms-content"),content)
            }
        });

        /**
         * 获取文本域光标并插入内容
         * @param obj
         * @param str
         */
        function insertText(obj,str) {
            obj.focus();
            if (document.selection) {
                var sel = document.selection.createRange();
                sel.text = str;
            } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {
                var startPos = obj.selectionStart,
                    endPos = obj.selectionEnd,
                    cursorPos = startPos,
                    tmpStr = obj.value;
                obj.value = tmpStr.substring(0, startPos) + str + tmpStr.substring(endPos, tmpStr.length);
                cursorPos += str.length;
                obj.selectionStart = obj.selectionEnd = cursorPos;
            } else {
                obj.value += str;
                // console.log(obj.value)
            }
            $(".synchronize_sms_content").text(obj.value);
        }

        /**
         * 把光标移动文本域末尾
         * @param obj
         */
        function moveEnd(obj){
            obj.focus();
            var len = obj.value.length;
            if (document.selection) {
                var sel = obj.createTextRange();
                sel.moveStart('character',len);
                sel.collapse();
                sel.select();
            } else if (typeof obj.selectionStart == 'number' && typeof obj.selectionEnd == 'number') {
                obj.selectionStart = obj.selectionEnd = len;
            }
        }



    });

</script>
</body>
</html>
{/block}