{extend name="layout/default" /}
{block name="content"}
<!--短信模版弹出begin-->
<div class="body-form sms-module-layer auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="" lay-filter="component-tabs-brief">
            <ul class="tabpage" id="tabs">
                <li class="" id="li1"><a href="#" class="tab1">推荐场景</a></li>
                <li class="" id="li2"><a href="#" class="tab2">模板库</a></li>
                <li class="" id="li3"><a href="#" class="tab3">历史发送</a></li>
                <li class="" id="li4"><a href="#" class="tab4">近期节日</a></li>
            </ul>
            <div class="contenttab" id="content">
                <div class="layui-row">
                    <div class="layui-tab-item" id="tab1">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-recommend-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="1" placeholder="" autocomplete="off" class="layui-input">
                                    <li>场景类型：
                                        <div class="layui-inline">
                                            <div class="layui-input-inline">
                                                <select name="recommended_scene" lay-verify="required" lay-search="">
                                                    <option value="4" selected>所有场景</option>
                                                    <option value="1">周年庆</option>
                                                    <option value="2">聚划算</option>
                                                    <option value="3">上新</option>
                                                </select>
                                            </div>
                                        </div>
                                    </li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab2">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-module" lay-filter="form-sms-module">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="sms_type" value="2" placeholder="" autocomplete="off" class="layui-input">
                                    <li>模板来源：
                                        <div class="layui-input-inline">
                                            <select name="modeltype" id="modeltype"  lay-verify="required" lay-search="">
                                                <option value="2" selected>所有类型</option>
                                                <option value="1">自定义模板</option>
                                                <option value="0">系统模板</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li>模板类型：
                                        <div class="layui-input-inline">
                                            <select name="selecttemp" id="selecttemp" lay-verify="required" lay-search="">
                                                <option value="0" selected="selected">所有模板</option>
                                                <option value="16">会员短信 </option>
                                                <option value="17">指定号码发送</option>
                                                <option value="18">订单短信群发 </option>
                                                <option value="1">催付提醒</option>
                                                <option value="2">发货提醒</option>
                                                <option value="3">催付关怀</option>
                                                <option value="4">派送提醒</option>
                                                <option value="5">签收提醒</option>
                                                <option value="6">回款关怀 </option>
                                                <option value="7">退款关怀 </option>
                                                <option value="8">评价关怀 </option>
                                                <option value="9">中差评安抚 </option>
                                                <option value="12">催评价 </option>
                                                <option value="13">下单提醒 </option>
                                                <option value="14">宝贝关怀 </option>
                                                <option value="15">智能凑单 </option>
                                            </select>
                                        </div>
                                    </li>
                                    <li>关键词：<input type="text" name="keyword" id="keyword" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab3">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-history-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="3" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                    <div class="layui-tab-item" id="tab4">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-latest-sms-module" lay-filter="form-sms-module">
                            <input type="hidden" name="sms_type" value="4" placeholder="" autocomplete="off" class="layui-input">
                        </form>
                    </div>
                </div>
                <div class="layui-row">
                    <table class="layui-hide" id="table-sms" lay-filter="table_sms" table-reload-id="tableReload"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--短信模版弹出end-->

<!--短链模版弹出begin-->
<div class="body-form short-href-layer auto-height-table" style="display: none">
    <div class="layui-form yty-tab">
        <div class="layui-tab" lay-filter="short-href-tab">
            <ul class="layui-tab-title tabpage">
                <li class="layui-this" lay-id="common_link"><a href="#">店铺常用链接</a></li>
                <li><a href="#">宝贝链接</a></li>
                <li><a href="#">宝贝分类</a></li>
                <li><a href="#">优惠券</a></li>
                <li><a href="#">搭配套餐</a></li>
                <li><a href="#">金店长活动</a></li>
            </ul>
            <div class="layui-tab-content" style="height: 100px;">
                <!--<div class="layui-row">-->
                    <div class="layui-tab-item layui-show common_link"></div>
                    <div class="layui-tab-item good_link">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-good-link" lay-filter="form-sms-good-link">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="short_sms_type" value="1" placeholder="" autocomplete="off" class="layui-input">
                                    <li>宝贝状态：
                                        <div class="layui-input-inline">
                                            <select name="goods_status" id="goods_status" lay-verify="required" lay-search="">
                                                <option value="1" selected>所有状态</option>
                                                <option value="2">出售中</option>
                                                <option value="3">仓库中</option>
                                            </select>
                                        </div>
                                    </li>
                                    <li>宝贝ID：<input type="text" name="goods_id" id="goods_id" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li>宝贝标题：<input type="text" name="goods_title" id="goods_title" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item gategory_list"></div>
                    <div class="layui-tab-item coupon_list"></div>
                    <div class="layui-tab-item match_list"></div>
                    <div class="layui-tab-item jdz_list">
                        <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-sms-jdz-list" lay-filter="form-sms-jdz-list">
                            <div class="searchbody">
                                <ul class="nav pull-left">
                                    <input type="hidden" name="short_sms_type" value="5" placeholder="" autocomplete="off" class="layui-input">
                                    <li>活动名称：<input type="text" name="act_name" id="act_name" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li>页面标题：<input type="text" name="act_title" id="act_title" placeholder="" autocomplete="off" class="layui-input"></li>
                                    <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                                        <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                                    </li></ul>
                            </div>
                        </form>
                    </div>
                <!--</div>-->
                <div class="layui-row">
                    <table class="layui-hide" id="table-short-link-sms" lay-filter="table-short-link-sms" table-reload-id="tableReload"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<!--短链模版弹出end-->

<!--设置黑名单begin-->
<div class="body-form black-module-layer auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="layui-row">
            <form class="layui-form" method="POST" action="/sms_data.json" tableid="tableReload" id="form-set-black" lay-filter="form-sms-good-link">
                <div class="searchbody">
                    <ul class="nav pull-left">
                        <li>云信/手机号码：<input type="text" name="uid_name" id="uid_name" placeholder="" autocomplete="off" class="layui-input"></li>
                        <li><button class="layui-btn layui-btn-sm layui-btn-normal search-info" type="button" lay-submit="" lay-filter="component-form-element"><i class="layui-icon layui-icon-search"></i>搜索</button>
                            <button type="reset" class="layui-btn layui-btn-normal layui-btn-sm layui-btn-sm"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
                        </li></ul>
                </div>
            </form>
        </div>
        <div class="layui-row">
            <table class="layui-hide" id="table_black" lay-filter="table_black" table-reload-id="tableReload"></table>
        </div>
    </div>
</div>
<!--设置黑名单end-->

<!--添加黑名单begin-->
<div class="body-form add-black-layer auto-height-table" style="display: none">
    <div class="layui-form">
        <div class="layui-row">
            <div class="layui-card main-table">
                <form class="layui-form" action="" id="rule" lay-filter="rule">
                <table class="layui-table table-border dashed-td" lay-skin="line" lay-size="sm">
                    <colgroup>
                        <col class="yty_tdleft" width="30%">
                        <col class="yty_tdright">
                    </colgroup>
                    <tr>
                        <td class="yty_tdleft">黑名单类型</td>
                        <td class="yty_tdright">
                            <input type="radio" name="sex" value="1" title="云信昵称" checked="">
                            <input type="radio" name="sex" value="2" title="手机号码">
                        </td>
                    </tr>
                    <tr>
                        <!--<td class="yty_tdleft"> 短信内容 :</td>-->
                        <td class="yty_tdright" colspan="2">
                            <textarea placeholder="请根据选择的类型输入昵称或手机号码(可以批量录入，每行输入一个)" class="layui-textarea" style="width: 100%;height: 80%"></textarea>
                        </td>
                    </tr>
                </table>
                <div class="layui-form-item layer-form-footer">
                        <div class="footer-inner">
                            <button type="submit" lay-submit="" lay-filter="form_add_black"
                                    class="layui-btn layui-btn-normal submit layui-btn-sm add-black-confirm btn-embossed">{:__('OK')}
                            </button>
                            <button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed reset">
                                取消
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            </div>
        </div>
    </div>
</div>
<!--添加黑名单end-->

<!--地区筛选自定义弹出begin-->
<div class="body-form layer-form" style="display: none">
    <div class="layui-card main-table">
        <div class="layui-card-body main-body">
            <div class="layui-form location_address_layer">
                <table class="layui-table table-border  dashed-td" lay-skin="line" lay-size="sm">
                    <colgroup>
                        <col class="yty_tdleft" width="30%">
                        <col class="yty_tdright">
                    </colgroup>
                    <tbody>
                    <tr>
                        <td class="yty_tdleft"></td>
                        <td colspan="2" class="yty_tdright">
                            <div class="layui-form">
                                <input type="radio" name="check_all" lay-filter="check_all" class="check_all"
                                       value="all" title="全选">
                                <input type="radio" name="check_all" lay-filter="check_all" value="none"
                                       class="check_all_none" title="反选">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">华东地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" lay-filter="cityId" value="1" lay-skin="primary"
                                       title="上海" class="">
                                <input type="checkbox" name="cityId[]" lay-filter="cityId" value="2" lay-skin="primary"
                                       title="浙江" class="">
                                <input type="checkbox" name="cityId[]" lay-filter="cityId" value="3" lay-skin="primary"
                                       title="江苏" class="">
                                <input type="checkbox" name="cityId[]" lay-filter="cityId" value="4" lay-skin="primary"
                                       title="安徽" class="">
                                <input type="checkbox" name="cityId[]" lay-filter="cityId" value="5" lay-skin="primary"
                                       title="江西" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">华北地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="6" lay-filter="cityId" lay-skin="primary"
                                       title="北京" class="">
                                <input type="checkbox" name="cityId[]" value="7" lay-filter="cityId" lay-skin="primary"
                                       title="天津" class="">
                                <input type="checkbox" name="cityId[]" value="8" lay-filter="cityId" lay-skin="primary"
                                       title="安徽" class="">
                                <input type="checkbox" name="cityId[]" value="9" lay-filter="cityId" lay-skin="primary"
                                       title="山西" class="">
                                <input type="checkbox" name="cityId[]" value="10" lay-filter="cityId" lay-skin="primary"
                                       title="山东" class="">
                                <input type="checkbox" name="cityId[]" value="11" lay-filter="cityId" lay-skin="primary"
                                       title="内蒙古" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">华中地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="12" lay-filter="cityId" lay-skin="primary"
                                       title="湖北" class="">
                                <input type="checkbox" name="cityId[]" value="13" lay-filter="cityId" lay-skin="primary"
                                       title="湖南" class="">
                                <input type="checkbox" name="cityId[]" value="14" lay-filter="cityId" lay-skin="primary"
                                       title="河南" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">华南地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="16" lay-filter="cityId" lay-skin="primary"
                                       title="广东" class="">
                                <input type="checkbox" name="cityId[]" value="17" lay-filter="cityId" lay-skin="primary"
                                       title="广西" class="">
                                <input type="checkbox" name="cityId[]" value="18" lay-filter="cityId" lay-skin="primary"
                                       title="福建" class="">
                                <input type="checkbox" name="cityId[]" value="19" lay-filter="cityId" lay-skin="primary"
                                       title="海南" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">东北地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="20" lay-filter="cityId" lay-skin="primary"
                                       title="辽宁" class="">
                                <input type="checkbox" name="cityId[]" value="21" lay-filter="cityId" lay-skin="primary"
                                       title="吉林" class="">
                                <input type="checkbox" name="cityId[]" value="22" lay-filter="cityId" lay-skin="primary"
                                       title="黑龙江" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">西北地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="23" lay-filter="cityId" lay-skin="primary"
                                       title="陕西" class="">
                                <input type="checkbox" name="cityId[]" value="24" lay-filter="cityId" lay-skin="primary"
                                       title="新疆" class="">
                                <input type="checkbox" name="cityId[]" value="25" lay-filter="cityId" lay-skin="primary"
                                       title="青海" class="">
                                <input type="checkbox" name="cityId[]" value="26" lay-filter="cityId" lay-skin="primary"
                                       title="宁夏" class="">
                                <input type="checkbox" name="cityId[]" value="27" lay-filter="cityId" lay-skin="primary"
                                       title="甘肃" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">西南地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="28" lay-filter="cityId" lay-skin="primary"
                                       title="四川" class="">
                                <input type="checkbox" name="cityId[]" value="29" lay-filter="cityId" lay-skin="primary"
                                       title="云南" class="">
                                <input type="checkbox" name="cityId[]" value="30" lay-filter="cityId" lay-skin="primary"
                                       title="贵州" class="">
                                <input type="checkbox" name="cityId[]" value="31" lay-filter="cityId" lay-skin="primary"
                                       title="西藏" class="">
                                <input type="checkbox" name="cityId[]" value="32" lay-filter="cityId" lay-skin="primary"
                                       title="重庆" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">港澳台地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="33" lay-filter="cityId" lay-skin="primary"
                                       title="香港" class="">
                                <input type="checkbox" name="cityId[]" value="34" lay-filter="cityId" lay-skin="primary"
                                       title="澳门" class="">
                                <input type="checkbox" name="cityId[]" value="35" lay-filter="cityId" lay-skin="primary"
                                       title="台湾" class="">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="yty_tdleft">海外地区:</td>
                        <td class="yty_tdright">
                            <div class="layui-form">
                                <input type="checkbox" name="cityId[]" title="全部" lay-skin="primary" class="all">
                                <input type="checkbox" name="cityId[]" value="36" lay-filter="cityId" lay-skin="primary"
                                       title="海外" class="">
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="layui-form-item layer-form-footer">
                    <div class="footer-inner">
                        <button type="submit" lay-submit="" lay-filter="formRule"
                                class="layui-btn layui-btn-normal submit layui-btn-sm btn-embossed">{:__('OK')}
                        </button>
                        <button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed reset">
                            {:__('Reset')}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--地区筛选自定义弹出end-->

<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12 webody">
            <div class="layui-card main-table">
                <div class="layui-card-header yty-card-header">
                    <!--<span class="sm-st-icon-left shop-info"><i class="fa  fa-ellipsis-v"></i></span>-->
                    <span class="step step-number-active step-one">1</span><span class="step-active">第一步：筛选条件</span>
                    <span class="step-line"></span>
                    <span class="step step-left">2</span>第二步：编辑短信
                </div>
                <div class="layui-card-body layui-card-body-padding">
                    <!--表格查询条件begin-->
                    <!--<div class="searchbody">-->
                        <form class="layui-form" method="post" action="" tableid="tableReload" id="formRule" lay-filter="member_sms">
                            <table  style="margin-bottom: 0px !important;" class="layui-table table-border  dashed-td" lay-skin="line" lay-size="sm" style="margin-bottom: 15px">
                                <colgroup>
                                    <col class="yty_tdright" width="120px">
                                    <col class="yty_tdright">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <td class="yty_tdleft"> 最近交易时间 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="不限" title="不限" checked>
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="近7天" title="近7天">
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="近1个月" title="近1个月">
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="近3个月" title="近3个月">
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="近半年" title="近半年">
                                        <input type="radio" name="recent_trading_time" lay-filter="recent_trading_time" value="自定义" title="自定义">
                                        <span class="customize_trade_time" style="display: none">
                                             <input type="text" name="trade_time_start" id="trade_time_start" placeholder="" autocomplete="off" class="layui-input"> — <input type="text" name="trade_time_end" id="trade_time_end" placeholder="" autocomplete="off" class="layui-input input-margin">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 交易次数 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="不限" title="不限" checked>
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="0次" title="0次">
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="1次" title="1次">
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="2次" title="2次">
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="3次及以上" title="3次及以上">
                                        <input type="radio" name="trade_counts" lay-filter="trade_counts" value="自定义" title="自定义">
                                        <span class="customize_trade_counts" style="display: none">
                                             <input type="number" name="trade_counts_start" id="trade_counts_start" placeholder="" autocomplete="off" class="layui-input"> — <input type="number" name="trade_counts_end" id="trade_counts_end" placeholder="" autocomplete="off" class="layui-input input-margin">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 累计金额 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="不限" title="不限" checked>
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="1~100元" title="1~100元">
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="100~200元" title="100~200元">
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="200~300元" title="200~300元">
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="300元以上" title="300元以上">
                                        <input type="radio" name="buy_total_money" lay-filter="buy_total_money" value="自定义" title="自定义">
                                        <span class="customize_total_money" style="display: none">
                                             <input type="number" name="total_money_start" id="total_money_start" placeholder="" autocomplete="off" class="layui-input"> — <input type="number" name="total_money_end" id="total_money_end" placeholder="" autocomplete="off" class="layui-input input-margin">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 平均客单价 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="不限" title="不限" checked>
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="1~100元" title="1~100元">
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="100~200元" title="100~200元">
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="200~300元" title="200~300元">
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="300元以上" title="300元以上">
                                        <input type="radio" name="avg_price" lay-filter="avg_price" value="自定义" title="自定义">
                                        <span class="customize_avg_price" style="display: none">
                                             <input type="number" name="avg_price_start" id="avg_price_start" placeholder="" autocomplete="off" class="layui-input"> — <input type="number" name="avg_price_end" id="avg_price_end" placeholder="" autocomplete="off" class="layui-input input-margin">
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 会员等级 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="membership_level[]" lay-filter="membership_level" lay-skin="primary" value="0"  title="所有会员" checked>
                                        <input type="checkbox" name="membership_level[]"  lay-filter="membership_level" lay-skin="primary" value="1"  title="店铺会员">
                                        <input type="checkbox" name="membership_level[]"  lay-filter="membership_level" lay-skin="primary" value="2"  title="普通会员">
                                        <input type="checkbox" name="membership_level[]"  lay-filter="membership_level" lay-skin="primary" value="3"  title="高级会员">
                                        <input type="checkbox" name="membership_level[]"  lay-filter="membership_level" lay-skin="primary" value="4"  title="VIP会员">
                                        <input type="checkbox" name="membership_level[]"  lay-filter="membership_level" lay-skin="primary" value="5"  title="至尊VIP会员">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 订单来源 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="trade_from[]" lay-filter="trade_from" lay-skin="primary" value="0"  title="所有订单" checked>
                                        <input type="checkbox" name="trade_from[]" lay-filter="trade_from" lay-skin="primary" value="1"  title="移动端">
                                        <input type="checkbox" name="trade_from[]"  lay-filter="trade_from" lay-skin="primary" value="2"  title="PC端">
                                        <input type="checkbox" name="trade_from[]"  lay-filter="trade_from" lay-skin="primary" value="3"  title="历史订单">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 地区筛选 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="location_address" lay-filter="location_address" lay-skin="primary" value="0"  title="不限" checked>
                                        <input type="radio" name="location_address" lay-filter="location_address" lay-skin="primary" value="1"  title="自定义">
                                        <input type="hidden" name="areaId" id="areaId" placeholder="" autocomplete="off" class="layui-input input-margin">
                                        <input type="hidden" name="areaIdH" id="areaIdH" placeholder="" autocomplete="off" class="layui-input input-margin">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 商品选择 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="pro_filter" lay-filter="pro_filter" lay-skin="primary" value="0"  title="不限" checked>
                                        <input type="radio" name="pro_filter" lay-filter="pro_filter" lay-skin="primary" value="1"  title="商品">
                                        <input type="radio" name="pro_filter" lay-filter="pro_filter" lay-skin="primary" value="2"  title="类目">
                                        <input type="radio" name="pro_filter" lay-filter="pro_filter" lay-skin="primary" value="3"  title="关键字">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 人群画像 :</td>
                                    <td class="yty_tdright">
                                        <input type="checkbox" name="crowd_portrait_type[]" lay-filter="crowd_portrait_type" lay-skin="primary" value="0"  title="不限" checked>
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="1"  title="学生">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="2"  title="IT">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="3"  title="金融族">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="4"  title="白领">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="5"  title="公务员">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="5"  title="家居族">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="5"  title="医护人员">
                                        <input type="checkbox" name="crowd_portrait_type[]"  lay-filter="crowd_portrait_type" lay-skin="primary" value="5"  title="其他">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"> 已发短信过滤 :</td>
                                    <td class="yty_tdright">
                                        <input type="radio" name="fitler_date" lay-filter="fitler_date" value="0" title="今天" checked>
                                        <input type="radio" name="fitler_date" lay-filter="fitler_date" value="1" title="近3天">
                                        <input type="radio" name="fitler_date" lay-filter="fitler_date" value="2" title="近7天">
                                        <input type="radio" name="fitler_date" lay-filter="fitler_date" value="3" title="近15天">
                                        <input type="radio" name="fitler_date" lay-filter="fitler_date" value="4" title="自定义">
                                        <span class="customize_fitler_date" style="display: none">
                                            近 <input type="number" name="customize_fitler_date" id="customize_fitler_date" placeholder="" autocomplete="off" class="layui-input"> 天
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="yty_tdleft"  style="border-bottom: none !important;"> 筛选操作 :</td>
                                    <td class="yty_tdright"  style="border-bottom: none !important;">
                                        <button type="button" lay-submit="" lay-filter="" class="layui-btn yty-btn  layui-btn-primary btn-primary-border layui-btn-sm">下一步</button>
                                        <button type="submit" lay-submit="" lay-filter="" class="layui-btn yty-btn  layui-btn-normal   layui-btn-sm">查询</button>
                                        <button type="reset" class="layui-btn layui-btn-sm  layui-btn-normal yty-btn">重置</button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <p class="search_result" style="display: block">
                                筛选结果： 共筛选出<span class="red_color">0位</span>会员，其中有效<span class="red_color">0位</span>会员（有手机号，并已排重，已过滤黑名单）数据不全？去导入历史订单
                            </p>
                            <!--<div class="layui-form-item footer-form">-->
                                <!--<div class="footer footer-common">-->
                                    <!--<button type="submit" lay-submit="" lay-filter="formRule" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed disabled">{:__('OK')}</button>-->
                                    <!--<button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed">{:__('Reset')}</button>-->
                                    <!--<a href="{:url($return_url)}"><div type="reset" style="margin-left: 10px" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed go-back">返回</div></a>-->
                                    <!--&lt;!&ndash;onclick="window.history.go(-1)"&ndash;&gt;-->
                                <!--</div>-->
                            <!--</div>-->
                        </form>
                    <!--</div>-->
                    <!--表格查询条件end-->

                    <!--订单查询结果begin-->
                    <!--<table class="layui-hide" id="rule" lay-filter="rule" table-reload-id="tableReload"></table>-->
                    <!--订单查询结果end-->
                </div>
            </div>
        </div>

        <div style="display: none" class="layui-col-md12 webody1">
            <div class="layui-card main-table">
                <div class="layui-card-header yty-card-header"><span class="sm-st-icon-left shop-info"><i class="fa  fa-ellipsis-v"></i></span>第二步：编辑短信  </div>
                <div class="layui-card-body main-body">
                    <!--表格查询条件begin-->
                    <!--<div class="searchbody">-->
                    <form class="layui-form" method="post" action="" tableid="tableReload" id="formRule" lay-filter="member_sms">
                        <div class="layui-row">
                            <div class="layui-col-md8">
                                <table class="layui-table table-border  dashed-td" lay-skin="line" lay-size="sm" style="margin-bottom: 15px">
                            <colgroup>
                                <col class="yty_tdright" width="110px">
                                <col class="yty_tdright">
                            </colgroup>
                            <tbody>
                            <tr>
                                <td class="yty_tdleft"> 短信标题 :</td>
                                <td class="yty_tdright">
                                     <input type="text" name="sms_title" id="sms_title"  placeholder="" autocomplete="off" class="layui-input width250">
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 短信内容 :</td>
                                <td class="yty_tdright label_sms">
                                    <ul class="ulstyle0">
                                        <li><a href="javascript:void(0);" id="buyer_name">卖家姓名</a></li>
                                        <li><a href="javascript:void(0);" id="buyer_customer_name">买家云信名称</a></li>
                                        <li><a href="javascript:void(0);" id="total_cost">消费总额</a></li>
                                        <li><a href="javascript:void(0);" id="shop_address">店铺地址</a></li>
                                        <li><a href="javascript:void(0);" id="recent_purchase_time">最近购买时间</a></li>
                                    </ul>
                                    <ul class="ulstyle1">
                                        <li><a href="javascript:void(0);" id="short_href">#短链#</a></li>
                                        <li><a href="javascript:void(0);" id="sms_module">#短信模板#</a></li>
                                    </ul>
                                    <!--<br>-->
                                    <!--<p class="marginbuttom5"></p>-->
                                    <textarea placeholder="请输入内容" class="layui-textarea yty-textarea sms-content" id="sms-content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</textarea>
                                    <p class="font12">已输入：<span class="red_color sms-content-length">62</span> 字(包含签名) 当前计费：<span class="red_color">1</span>条 <span class="astyle tips-icon font14" title-icon="1、单条70个字,超出70个字将按照67个字每条计算<br>
2、一个汉字,数字,字母,空格都算一个字<br>
3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！">计费规则(重要)</span></p>
                                    <!--<p class="font12">1、单条70个字,超出70个字将按照67个字每条计算<br></p>
                                    <p class="font12">2、一个汉字,数字,字母,空格都算一个字<br></p>
                                    <p class="font12">3、带标签的短信按实际发出的长度计算！因部分标签替换后长短不一（如买家昵称,商品名称,商品简称等），请以实际替换后长度为准，已输入字数提示仅供参考！</p>-->
                                    <p class="font12">提示：<span class="red_color">标签和链接前后需有空格分隔，请勿删除前后空格！</span></p>
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 短信签名 :</td>
                                <td class="yty_tdright">
                                    <input type="radio" name="location_address" lay-filter="location_address" lay-skin="primary" value="【u[1715093595]】"  title="【u[1715093595]】" checked>
                                    <input type="radio" name="location_address" lay-filter="location_address" lay-skin="primary" value="自定义签名"  title="自定义签名">
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 短信测试 :</td>
                                <td class="yty_tdright">
                                    <input type="text" name="sms_test" id="sms_test"  placeholder="可输入5个测试手机号，用逗号“，”隔开" autocomplete="off" class="layui-input width250">
                                    <button type="button" lay-submit="" lay-filter="" class="layui-btn yty-btn layui-btn-primary btn-primary-border layui-btn-sm btn-embossed">查询</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 发送号码 :</td>
                                <td class="yty_tdright">
                                    <input type="radio" name="send_mobile_type" lay-filter="send_mobile_type" lay-skin="primary" value="0"  title="优先收货人号码" checked>
                                    <input type="radio" name="send_mobile_type" lay-filter="send_mobile_type" lay-skin="primary" value="1"  title="优先支付宝号码">
                                    <input type="radio" name="send_mobile_type" lay-filter="send_mobile_type" lay-skin="primary" value="2"  title="只发收货人号码">
                                    <input type="radio" name="send_mobile_type" lay-filter="send_mobile_type" lay-skin="primary" value="3"  title="只发支付宝号码">
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 发送人数 :</td>
                                <td class="yty_tdright">
                                    <input type="radio" name="send_limit_type" lay-filter="send_limit_type" lay-skin="primary" value="0"  title="全部" checked>
                                    <input type="radio" class="customize" name="send_limit_type" lay-filter="send_limit_type" lay-skin="primary" value="1"  title="部分">
                                    <span class="customize_send_limit_type" style="display: none">
                                        <input type="text" name="part_people" id="part_people" value="0" placeholder="" autocomplete="off" class="layui-input">
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"> 发送时间 :</td>
                                <td class="yty_tdright">
                                    <input type="radio" name="send_time_type" lay-filter="send_time_type" lay-skin="primary" value="0"  title="立即发送" checked>
                                    <input type="radio" class="customize" name="send_time_type" lay-filter="send_time_type" lay-skin="primary" value="1"  title="定时发送">
                                    <span class="customize_send_time_type" style="display: none">
                                        <input type="text" name="timing" id="timing"  placeholder="" autocomplete="off" class="layui-input">
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="yty_tdleft"  style="border-bottom: none !important;"></td>
                                <td class="yty_tdright"  style="border-bottom: none !important;">
                                    <button type="submit" lay-submit="" lay-filter="" class="layui-btn yty-btn  layui-btn-primary btn-primary-border layui-btn-sm btn-embossed">上一步</button>
                                    <button type="reset" class="layui-btn layui-btn-sm layui-btn-normal yty-btn btn-embossed">发送短信</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                            </div>
                            <div class="layui-col-md4">
                                <div class="sms-phone">
                                    <div class="phone-container">
                                        <div class="smg-content">
                                            【覃雪宁88】<span class="synchronize_sms_content">注意防骗：如骗子电话短.信骚扰说订单不能发货索取账号信息及银行.卡信息，千万不能相信，有任何问题上线联系客服哦，谨防诈骗！</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--<div class="layui-form-item footer-form">-->
                        <!--<div class="footer footer-common">-->
                        <!--<button type="submit" lay-submit="" lay-filter="formRule" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed disabled">{:__('OK')}</button>-->
                        <!--<button type="reset" class="layui-btn layui-btn-sm layui-btn-normal btn-embossed">{:__('Reset')}</button>-->
                        <!--<a href="{:url($return_url)}"><div type="reset" style="margin-left: 10px" class="layui-btn layui-btn-normal layui-btn-sm btn-embossed go-back">返回</div></a>-->
                        <!--&lt;!&ndash;onclick="window.history.go(-1)"&ndash;&gt;-->
                        <!--</div>-->
                        <!--</div>-->
                    </form>
                    <!--</div>-->
                    <!--表格查询条件end-->

                    <!--订单查询结果begin-->
                    <!--<table class="layui-hide" id="rule" lay-filter="rule" table-reload-id="tableReload"></table>-->
                    <!--订单查询结果end-->
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!--头工具栏-->
<!--{:build_toolbar('toolbar',['refresh'])}-->

<!--表格头部按钮begin-->
<!--<script type="text/html" id="toolbar">-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="search"><i class="fa fa-search"></i> 查询</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="sendSms"><i class="fa fa-envelope-o"></i> 发送短信</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="sendSearchResultSms"><i class="fa fa-envelope-o"></i> 按查询结果发送</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="addOrder"><i class="fa fa-plus"></i> 添加订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="importOrder"><i class="fa fa-file-text-o"></i> 导入苏宁订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="exportOrder"><i class="fa fa-file-o"></i> 导出苏宁订单</a>-->
    <!--<a class="layui-btn layui-btn-sm layui-btn-normal" lay-event="toBlack"><i class="fa fa-hand-o-down"></i> 拉黑</a>-->
<!--</script>-->
<!--表格头部按钮end-->

<!--头工具栏-->

<!--状态-->
<script type="text/html" id="switchStatus">
    <input type="checkbox" name="status" value="{{d.status}}" lay-skin="switch" lay-text="启用|禁用" lay-filter="ruleStatus" {{ d.status == 1 ? 'checked' : '' }}>
</script>

<!--状态-->
<script type="text/html" id="switchPush">
    <input type="checkbox" name="is_time_push" value="{{d.is_time_push}}" lay-skin="switch" lay-text="是|否" lay-filter="ruleIsmenu" {{ d.is_time_push == 1 ? 'checked' : '' }}>
</script>

<!--短信模板操作begin-->
<script type="text/html" id="actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="use_sms_module">使用</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del_sms_module">删除</a>
</script>
<!--短信模板操作end-->


<!--短链操作begin-->
<script type="text/html" id="short_sms_actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="use_sms_short_link">选择链接</a>
</script>
<!--短链操作end-->

<!--设置黑名单头部工具栏begin-->
<script type="text/html" id="set_black_toolbar">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm layui-btn-normal" lay-event="add_black"><i class="fa fa-plus"></i>添加黑名单</button>
    </div>
</script>
<!--设置黑名单头部工具栏end-->

<!--短信模板操作begin-->
<script type="text/html" id="set_black_actionbar">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="use_sms_module">取消黑名单</a>
</script>
<!--短信模板操作end-->

{/block}

{block name="script"}
<script>
    layui.config({
        base: "__STATIC__/", //静态资源所在路径
        skin: 'layui-layer-we',
        version:true,
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index','table','upload','laydate','element','form','authtree','we','weTable','formSearch','formEvent'], function(){
        var admin = layui.admin
            ,element = layui.element
            ,layer = layui.layer
            ,we = layui.we
            ,table = layui.table
            ,$  = layui.$
            ,laydate = layui.laydate
            ,form = layui.form
            ,weTable = layui.weTable
            ,formSearch = layui.formSearch
            ,init_i = init_j = init_m = 0
            ,formEvent = layui.formEvent
            ,toastr = layui.toastr;

        /**
         *
         * 时间初始化
         * */
        laydate.render({
            elem: '#day_hour_start' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'09:00:00'
        });
        laydate.render({
            elem: '#day_hour_end' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'21:00:00'
        });

        laydate.render({
            elem: '#siesta_hour_start' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'12:00:00'
        });
        laydate.render({
            elem: '#siesta_hour_end' //指定元素
            ,type: 'time'
            // ,format:'H'
            ,value:'13:00:00'
        });
        laydate.render({
            elem: '#trade_time_start' //指定元素
            ,type: 'date'
            // ,format:'H'
        });
        laydate.render({
            elem: '#trade_time_end' //指定元素
            ,type: 'date'
            // ,format:'H'
        });
        laydate.render({
            elem: '#task_time_start' //指定元素
            ,type: 'date'
            // ,format:'H'
        });
        laydate.render({
            elem: '#task_time_end' //指定元素
            ,type: 'date'
            // ,format:'H'
        });
        laydate.render({
            elem: '#timing' //指定元素
            ,type: 'datetime'
            // ,format:'H'
        });
        /**
         *
         * 发送时间事件切换
         * */
        form.on('radio(date_switch)', function(data){
            // console.log(data.elem);
            // console.log(data.value)
            if(data.value == 0){
                $(".task_time").show()
            }else(
                $(".task_time").hide()
            )
        });


        /**
         * 屏蔽标旗点击切换
         */
        $("body").on("click","ul li",function (){
            if($(this).hasClass('checkbox-active')) {
                $(this).removeClass('checkbox-active');
            } else {
                $(this).addClass('checkbox-active')
            }
        });

        /**
         * 修改短息内容弹框
         */
        $("body").on("click",".sms-event",function (){
            we.api.open_current_page_layer($(".sms-layer"),'修改短息内容',{zIndex:19891015
            },['80%' , '80%']);
            var areaId = [];
            var areaIdCh = []
            //选中省份
            $("body").on("click",".submit",function (){
                $(".body-form input[type=checkbox]").each(function (index,value) {
                    if($(this).is(':checked') && $(this).val() != 'on') {
                        areaId.push($(this).val());
                        areaIdCh.push($(this).attr('title'));
                    }
                })
                $("#areaId").val(areaIdCh.join(','));
                $("#areaIdH").val(areaId.join(','));
                layer.closeAll();
            });
            //重置
            $("body").on("click",".reset",function (){
                layer.closeAll();
            });
        })

        /**
         * 选择模板短信
         * */
        $("body").on("click","#sms_module,#tabs .tab1",function (){
            // console.log(this);
            var title = "tab1";
            $("#tabs").find("li[id^=li]").not("li[id=" + title + "]").removeClass("currenttab");
            $('#li1').addClass('currenttab');
            $("#content").find("div[id^=tab]").not("div[id=" + title + "]").hide();
            $("#content").find("div[id=" + title + "]").fadeIn();
            sms_table_init("form#form-recommend-sms-module",1);
        })

        /**
         * 短信模板切换初始化
         * */
        $("#tabs").find("li[id^=li]").find("a").bind("click", function () {
            var title = $(this).attr("class");
            // console.log($("#content").find("div[id=" + title + "]").find("form").attr('id'));
            sms_table_init("form#"+$("#content").find("div[id=" + title + "]").find("form").attr('id'),0);
        })


        /**
         * 选择短信模板初始化，sms_type：1推荐场景，sms_type：2模板库，sms_type：3历史发送，sms_type：4近期节日
         * */
        function sms_table_init(form,flag){
            var tableCommon = {
                elem: '#table-sms'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                // ,toolbar : '#toolbar'
                ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: [[
                    {type:'checkbox', fixed: 'left', hide:true}
                    ,{field:'sms_id', title: 'id', hide:true}
                    ,{field:'sms_content', title: '短信内容'}
                    ,{fixed: 'right', title:'操作', toolbar: '#actionbar', width:250}
                ]]
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            if((form == "form#form-recommend-sms-module" && init_i == 0) || flag == 1) {
               index_sms = we.api.open_current_page_layer($(".sms-module-layer"),'选择短信模版',{zIndex:19891016
                },['80%' , '80%']);//搜索短信模版弹框

                // $.each($("#content .layui-row .layui-tab-item"),function (index, value) {
                //     console.log($(this).find("form").attr("id"));
                // })

                if(init_i == 0){
                    $.each($("#content .layui-row .layui-tab-item"),function (index, value) {
                        // console.log($(this).find("form").attr("id"));
                        formSearch.api.searchForm($("form#" + $(this).find("form").attr("id"))); //短信模板查询事件初始化
                    })
                    // formSearch.api.searchForm($("form#form-recommend-sms-module"));
                    // formSearch.api.searchForm($("form#form-history-sms-module"));
                    // formSearch.api.searchForm($("form#form-sms-module"));
                    // formSearch.api.searchForm($("form#form-latest-sms-module"));
                }
            }
            init_i ++;
            /**
             * 绑定监听事件
             * */
            // formSearch.api.searchForm($(form));
            // console.log(index_sms);
            //formSearch.api.searchForm($("form#form-recommend-sms-module"));////短信搜索初始化【推荐场景】
            //formSearch.api.searchForm($("form#form-sms-module"));//短信搜索初始化【模板库】
        }

        /**
         *
         * 搜索短信模板
         * */
        /*$('body').on('click','.search-info',function () {
            console.log(JSON.stringify(formSearch.api.getFormJson("#form-sms-module")));
        })*/

        //选择短信模板头工具栏事件
        table.on('tool(table_sms)', function(obj){
            console.log(obj);
            var data = obj.data;
            console.log(data.sms_id);
            if(obj.event === 'use_sms_module'){
                layer.close(index_sms)
                $(".sms-content").val(data.sms_content)
                $(".synchronize_sms_content").text(data.sms_content)
            } else if(obj.event === 'del_sms_module') {
                var sms_id = data.sms_id;
                var url = "";
                we.api.ajax({"url":url,"data":{'sms_id':sms_id}});   //对接后台删除
                //执行删除
            }
        })

        /**
         * 短链接弹框short-href-layer
         * */
        $("body").on("click","#short_href",function (){
            // console.log(this);
            sms_short_table_init('', {'short_sms_type':0});
            element.tabChange('short-href-tab', 'common_link');
            short_sms_layer_index = we.api.open_current_page_layer($(".short-href-layer"),'添加短链',{zIndex:19891016
            },['80%' , '80%']);
        })

        /**
         * 短链切换监听
         * */
        element.on('tab(short-href-tab)', function(data){
            // console.log(this); //当前Tab标题所在的原始DOM元素
            // console.log(d ata.index); //得到当前Tab的所在下标
            // console.log(data); //得到当前的Tab大容器
            var where = {'short_sms_type':data.index};
            switch (data.index) {
                case 0:
                    sms_short_table_init('', where);
                    break;
                case 1:
                    sms_short_table_init('', where);
                    break;
                case 2:
                    sms_short_table_init('', where);
                    break;
                case 3:
                    sms_short_table_init('', where);
                    break;
                case 4:
                    sms_short_table_init('', where);
                    break;
                case 5:
                    sms_short_table_init('', where);
                    break;
            }

        });

        /**
         * 短链接表格初始化
         * */
        function sms_short_table_init(form,where,flag){
            var cols1 = [[
                {type:'checkbox', fixed: 'left', hide:true}
                ,{field:'sms_id', title: 'id', hide:true}
                ,{field:'sms_content', title: '短链内容'}
                ,{fixed: 'right', title:'操作', toolbar: '#short_sms_actionbar', width:250}
            ]];

            var cols2 = [[
                {type:'checkbox', fixed: 'left', hide:true}
                ,{field:'sms_id', title: 'id', hide:true}
                ,{field:'activity_name',title:'活动名称'}
                ,{field:'sms_content', title: '活动标题'}
                ,{field:'sms_create_time', title: '创建时间'}
                ,{fixed: 'right', title:'操作', toolbar: '#short_sms_actionbar', width:250}
            ]];
            var cols = cols1;
            if(typeof where !== 'undefined'){
                var cols = where.short_sms_type == 5 ? cols2 : cols1;
            }
            console.log(where)
            var tableCommon = {
                elem: '#table-short-link-sms'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                // ,toolbar : '#toolbar'
                // ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: cols
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where:where
                // ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            if(init_j == 0){
                formSearch.api.searchForm($("form#form-sms-good-link"));
                formSearch.api.searchForm($("form#form-sms-jdz-list"));
            }
            init_j ++;
            /**
             * 绑定监听事件
             * */
            // formSearch.api.searchForm($(form));
            // console.log(index_sms);
            //formSearch.api.searchForm($("form#form-recommend-sms-module"));////短信搜索初始化【推荐场景】
            //formSearch.api.searchForm($("form#form-sms-module"));//短信搜索初始化【模板库】
        }

        //短链工具栏事件
        table.on('tool(table-short-link-sms)', function(obj){
            console.log(obj);
            var data = obj.data;
            console.log(data.sms_id);
            if(obj.event === 'use_sms_short_link'){
                layer.close(short_sms_layer_index)
                insertText(document.getElementById("sms-content"),'c.tb.cn/c.02iCLm')//测试数据
            } else if(obj.event === 'del_sms_module') {

            }
        })

        /**
         * 设置黑名单弹框
         * */
        $("body").on("click",".set_black",function (){
            var tableCommon = {
                elem: '#table_black'
                ,url:"/sms_data.json" //对接请求后台数据
                // ,data:"./sms_data.json" //测试数据
                ,id : 'tableReload'
                ,skin:'line'
                ,limit:10
                ,defaultToolbar: ['filter']
                ,toolbar : '#set_black_toolbar'
                ,data:{'Search':"{:__('Search')}",'Reset':"{:__('Reset')}"}
                ,search: false
                ,cols: [[
                    {type:'checkbox', fixed: 'left', hide:true}
                    ,{field:'id', title: 'id', hide:true}
                    ,{field:'uid_name', title: '云信/手机号码'}
                    ,{field:'black_type', title: '黑名单类型'}
                    ,{field:'add_time', title: '添加时间'}
                    ,{field:'source', title: '添加来源'}
                    ,{fixed: 'right', title:'操作', toolbar: '#set_black_actionbar', width:250}
                ]]
                ,page: {
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    ,first: false //不显示首页
                    ,last: false //不显示尾页

                }
                ,where: {filter:JSON.stringify(formSearch.api.getFormJson($(form)))}   //搜索条件
                ,done: function(res, curr, count){
                    if(res.status == 'success') {
                        // layer.closeAll();
                    }
                }
            };

            table.render(tableCommon); //数据表格初始化
            set_black_layer_index = we.api.open_current_page_layer($(".black-module-layer"),'设置黑名单',{zIndex:19891016
            },['80%' , '80%']);

            if(init_m == 0) {
                formSearch.api.searchForm($("form#form-set-black"));
            }
        })

        /**
         *设置黑名单头部操作
         * */
        table.on('toolbar(table_black)', function(obj){
            console.log(obj.event);
            if(obj.event == 'add_black'){
                add_black_layer_index = we.api.open_current_page_layer($(".add-black-layer"),'添加黑名单',{zIndex:19891017
                },['40%' , '60%']);
            }
        });

            /**
         * sms_record短信测试发送记录
         * */
        $("body").on("click",".sms_record",function (){
            var url = "{:url('admin/order/sms_record')}"
            we.api.open(url,'短信测试发送记录');
        })

        /**
         * tips-icon 弹出信息、销毁信息
         */
        $("body").on("mouseenter",".tips-icon",function (){
            var title = $(this).attr('title-icon');
            // console.log(title)
            index = layer.tips(title,this, {tips:[1,"#506def"],time:0,area: '400px',zIndex:1000000000})
        })
        $("body").on("mouseleave",".tips-icon",function (){
            layer.close(index);
        })

        /**
         * 短信标签设置
         */
        $("body").on("click",".label_sms ul li",function (){
            console.log($(this).text());
            var label_id = $(this).children().attr('id');
            var content = "{" +$(this).text()+ "}";
            if(typeof label_id !== 'undefined'){
                console.log(label_id);
                var title = '';
                if(label_id == 'order_id'){
                    title = '{订单编号} 实际替换后长度约为16个字，实际扣费以发出字数为准，您是否确定添加？';
                } else if(label_id == 'product_name'){
                    title = "{商品简称} 需要对宝贝设置对应的商品简称，未设置简称的宝贝加入该标签将不展示标签内容，您可以选择继续添加或者<a class='astyle' href='javascript:void(0);'>设置商品简称</a>？";
                } else if(label_id == 'sms_module' || label_id == 'short_href') {
                    return false;
                }
                if(title != '') {
                    layer.confirm(title,{
                        title:'温馨提示',area: ['400px','250px'],zIndex:19891016
                    }, function(index){
                        we.insertText(document.getElementById("sms-content"),content)
                        we.layer.close(index);
                    });
                } else {
                    we.insertText(document.getElementById("sms-content"),content)
                }
            } else {
                we.insertText(document.getElementById("sms-content"),content)
            }
        });

        /**
         *修改短信内容后点击确定
         * sms-confirm
         * */
        $("body").on("click",".sms-confirm",function (){
            $('.sms-content-last').val($('.sms-content').val());
        });

            /**
         * 获取文本域光标并插入内容
         * @param obj
         * @param str
         */
//        function insertText(obj,str) {
//            obj.focus();
//            if (document.selection) {
//                var sel = document.selection.createRange();
//                sel.text = str;
//            } else if (typeof obj.selectionStart === 'number' && typeof obj.selectionEnd === 'number') {
//                var startPos = obj.selectionStart,
//                    endPos = obj.selectionEnd,
//                    cursorPos = startPos,
//                    tmpStr = obj.value;
//                obj.value = tmpStr.substring(0, startPos) + str + tmpStr.substring(endPos, tmpStr.length);
//                cursorPos += str.length;
//                obj.selectionStart = obj.selectionEnd = cursorPos;
//            } else {
//                obj.value += str;
//                // console.log(obj.value)
//            }
//            $(".synchronize_sms_content").text(obj.value);
//        }

        /**
         * 把光标移动文本域末尾
         * @param obj
         */
//        function moveEnd(obj){
//            obj.focus();
//            var len = obj.value.length;
//            if (document.selection) {
//                var sel = obj.createTextRange();
//                sel.moveStart('character',len);
//                sel.collapse();
//                sel.select();
//            } else if (typeof obj.selectionStart == 'number' && typeof obj.selectionEnd == 'number') {
//                obj.selectionStart = obj.selectionEnd = len;
//            }
//        }

        /**
         * 最近交易时间事件监听
         * */
        form.on('radio(recent_trading_time)', function(data){
            if(data.value == '自定义'){
                $(".customize_trade_time").show()
            }else(
                $(".customize_trade_time").hide()
            )
        });

        /**
         * 交易次数事件监听
         * */
        form.on('radio(trade_counts)', function(data){
            if(data.value == '自定义'){
                $(".customize_trade_counts").show()
            }else(
                $(".customize_trade_counts").hide()
            )
        });

        /**
         * 交易次数事件监听
         * */
        form.on('radio(buy_total_money)', function(data){
            if(data.value == '自定义'){
                $(".customize_total_money").show()
            }else(
                $(".customize_total_money").hide()
            )
        });

        /**
         * 平均客单价事件监听
         * */
        form.on('radio(avg_price)', function(data){
            if(data.value == '自定义'){
                $(".customize_avg_price").show()
            }else(
                $(".customize_avg_price").hide()
            )
        });

        /**
         * 发送人数事件监听
         * */
        form.on('radio(send_limit_type)', function(data){
            if(data.value == '1'){
                $(".customize_send_limit_type").show()
            }else(
                $(".customize_send_limit_type").hide()
            )
        });

        /**
         * 发送人数事件监听
         * */
        form.on('radio(send_time_type)', function(data){
            if(data.value == '1'){
                $(".customize_send_time_type").show()
            }else(
                $(".customize_send_time_type").hide()
            )
        });

        /**
         * 已发短信过滤事件监听
         * */
        form.on('radio(fitler_date)', function(data){
            if(data.value == 4){
                $(".customize_fitler_date").show()
            }else(
                $(".customize_fitler_date").hide()
            )
        });

        /**
         * 会员等级、订单来源
         */
//        all_check_not('checkbox(membership_level)');
//        all_check_not('checkbox(trade_from)');
        formEvent.api.all_check_not('checkbox(membership_level)');
        formEvent.api.all_check_not('checkbox(trade_from)');
//        function all_check_not(event_obj) {
//            form.on(event_obj, function(data){
//                var value = data.value;
//                console.log(data.elem.checked);
//                if(value != 0) {
//                    if (data.elem.checked){
//                        $(this).parent("td").children('input').first().prop('checked', false);
//                        $(this).parent("td").children('.layui-form-checkbox').first().removeClass('layui-form-checked');
//                    }
//                } else {
//                    if (data.elem.checked){
//                        $(this).parent("td").children('input').not(':first').prop('checked', false);
//                        $(this).parent("td").children('.layui-form-checkbox').not(':first').removeClass('layui-form-checked');
//                    }
//                }
//            });
//        }

        /**
         * 省份点击
         */
        form.on('radio(location_address)', function(data){
            if(data.value == 1){
                we.api.open_current_page_layer($(".layer-form"),'选择所在省份',{
                },['80%' , '*']);
                var areaId = [];
                var areaIdCh = []
                //选中省份
                $("body").on("click",".submit",function (){
                    $(".body-form input[type=checkbox]").each(function (index,value) {
                        if($(this).is(':checked') && $(this).val() != 'on') {
                            areaId.push($(this).val());
                            areaIdCh.push($(this).attr('title'));
                        }
                    })
                    $("#areaId").val(areaIdCh.join(','));
                    $("#areaIdH").val(areaId.join(','));
                    layer.closeAll();
                });
                //重置
                $("body").on("click",".reset",function (){
                    layer.closeAll();
                });
            }
        })

        /**
         *省份全选、反选
         */
        form.on('radio(check_all)', function(data){
            var value = data.value;
            if(value == 'all') {
                $(".location_address_layer").find("input[type=checkbox]").prop('checked', true);
                $(".location_address_layer").find(".layui-form-checkbox").addClass('layui-form-checked');
            } else {
                $(".location_address_layer").find("input[type=checkbox]").prop('checked', false);
                $(".location_address_layer").find(".layui-form-checkbox").removeClass('layui-form-checked');
            }
        });

        /**
         * 地区点击选中事件、分区全选、反选
         */
        formEvent.api.all_check_none(".location_address_layer .layui-form-checkbox");
//        $("body").on("click",".location_address_layer .layui-form-checkbox",function (){
//            var p = $(this).prev();
//            if(p.attr('class') == 'all' && p.attr('class') !== 'undefined') {
//                if($(this).hasClass('layui-form-checked')){
//                    $(this).parent(".layui-form").children('input').prop('checked', true);
//                    $(this).parent(".layui-form").children('.layui-form-checkbox').addClass('layui-form-checked');
//                } else {
//                    $(this).parent(".layui-form").children('input').prop('checked', false);
//                    $(this).parent(".layui-form").children('.layui-form-checkbox').removeClass('layui-form-checked');
//                }
//            }else {
//                if(!$(this).hasClass('layui-form-checked')){
//                    $(this).parent(".layui-form").find('input').first().prop('checked', false);
//                    $(this).parent(".layui-form").find('.layui-form-checkbox').first().removeClass('layui-form-checked');
//                }else{
//                    var this_ = $(this);
//                    this_.parent(".layui-form").find('.layui-form-checkbox').not(':first').each(function (i) {
//                        if (!$(this).hasClass('layui-form-checked')) {
//                            this_.parent(".layui-form").find('input').first().prop('checked', false);
//                            this_.parent(".layui-form").find('.layui-form-checkbox').first().removeClass('layui-form-checked');
//                            return false;
//                        } else {
//                            this_.parent(".layui-form").find('input').first().prop('checked', true);
//                            this_.parent(".layui-form").find('.layui-form-checkbox').first().addClass('layui-form-checked');
//                        }
//                    });
//                }
//            }
//        });
        /**
         * 短信标签 输入框输入
         */
//        we.monitor_input($('#sms-content'), $('.synchronize_sms_content'));
        $('#sms-content').bind('input porpertychange',function(){
            console.log($(this).val().length);
            $('.synchronize_sms_content').text($(this).val());
            $('.sms-content-length').text($(this).val().length);
        });

        /**
         *
         */
        $("body").on("click",".customize",function (){
            console.log($(this).attr('title'));
        });
    });

</script>
</body>
</html>
{/block}